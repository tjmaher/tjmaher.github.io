---
layout: post
title: 'RESTful Testing with Stripe: Using UriBuilder, HttpGet and other Apache HttpComponents'
date: '2016-02-25T00:03:00.000-05:00'
author: T.J. Maher
tags:
- code examples
- Java
- intermediate
- Rest API
modified_time: '2016-04-29T07:36:21.636-04:00'
blogger_id: tag:blogger.com,1999:blog-3868566217808655382.post-5765424463201572531
blogger_orig_url: http://www.tjmaher.com/2016/02/restful-testing-with-stripe-using.html
---

<i>This post is fourth in a series of six. Need to go <a href="/2016/02/coming-up-how-to-work-with-rest-apis.html">back to the beginning</a>? </i><br><br>Now that we built a skeleton framework to test using the Stripe REST API, storing and retrieving the API Key, we can perform actions. We are going to:<br /><ul><li>Create a method called getListOfCharges in our StripeUtils class, where we can pass in how many charges we wish to retrieve.&nbsp;</li><li>Create a data object to hold all the information we retrieve.</li><li>Add functionality that turns the JSON object we get back, and add all information into the data object we created, using Google's GSON library.</li></ul><h3>What Our Framework Will Look Like</h3>By the end of this blog post, our automation framework will look like:<br /><br /><a name='more'></a><br /><br /><b>src/test/java</b><br /><ul><li>data</li><ul><li>LoadProperties.java</li></ul><li>libraries</li><ul><li>StripeUtils.java</li></ul><li>maps</li><ul><li>CollectionOfCharges.java</li></ul><li>properties</li><ul><li>qa-properties.properties</li></ul><li>testcases</li><ul><li>Stripe.java</li></ul></ul><h3></h3><h3>Design a Simple Data Object</h3><br />Let's say we want to get the last Charge object using HTTPS, we would enter using the public Stripe API Key into our browser:<br /><br /><pre style="background: #f0f0f0; border: 1px dashed #cccccc; color: black; font-family: &quot;arial&quot;; font-size: 12px; height: auto; line-height: 20px; overflow: auto; padding: 0px; text-align: left; width: 99%;"><code style="color: black; word-wrap: normal;"> https://api.stripe.com/v1/charges?limit=1&amp;key=sk_test_BQokikJOvBiI2HlWgH4olfQ2  <br /></code></pre><br />... Remembering, of course, that entering a non-public secret API key into a URL is a completely lousy idea! We will be remedying this later.<br /><br />If you take a look at the JSON file returned it looks like:<br /><br /><pre style="background: #f0f0f0; border: 1px dashed #cccccc; color: black; font-family: &quot;arial&quot;; font-size: 12px; height: auto; line-height: 20px; overflow: auto; padding: 0px; text-align: left; width: 99%;"><code style="color: black; word-wrap: normal;"> {  <br />  "object": "list",  <br />  "data": [  <br />   *** LOTS OF CHARGE DATA ***  <br />  ],  <br />  "has_more": true,  <br />  "url": "/v1/charges"  <br /> }  <br /></code></pre><br />This means we need to create a Data Object to store information, we only have to worry about &nbsp;four parameters:<br /><ul><li>A string named "object"</li><li>Object array named "data"</li><li>A boolean named "has_more"</li><li>A string named "url"</li></ul><br />Our Data Object will look like...<br /><br />stripe.maps.<b>CollectionOfCharges.java</b><br /><pre style="background: rgb(240, 240, 240); border: 1px dashed rgb(204, 204, 204); font-family: arial; font-size: 12px; height: auto; line-height: 20px; overflow: auto; padding: 0px; width: 646.469px;"><code style="word-wrap: normal;"> public class CollectionOfCharges {  <br />  String object;  <br />  Object[] data;  <br />  boolean has_more;  <br />  String url;  <br />  public String getObject() {  <br />   return object;  <br />  }  <br />  public void setObject(String object) {  <br />   this.object = object;  <br />  }  <br />  public Object[] getData() {  <br />   return data;  <br />  }  <br />  public void setData(Object[] data) {  <br />   this.data = data;  <br />  }  <br />  public boolean isHas_more() {  <br />   return has_more;  <br />  }  <br />  public void setHas_more(boolean has_more) {  <br />   this.has_more = has_more;  <br />  }  <br />  public String getUrl() {  <br />   return url;  <br />  }  <br />  public void setUrl(String url) {  <br />   this.url = url;  <br />  }  <br /> }  <br /></code></pre><br />Next, we need to get the data. We will be doing this with Apache Http Components.<br /><br /><h3>Why Use Apache HttpComponents?&nbsp;</h3>From the Apache <a href="https://hc.apache.org/httpcomponents-client-ga/tutorial/html/" target="_blank">HttpClient Tutorial</a>: <br /><blockquote class="tr_bq" style="font-size: medium; font-weight: normal;">"The Hyper-Text Transfer Protocol (HTTP) is perhaps the most significant protocol used on the Internet today. Web services, network-enabled appliances and the growth of network computing continue to expand the role of the HTTP protocol beyond user-driven web browsers, while increasing the number of applications that require HTTP support.<br /><br />"Although the java.net package provides basic functionality for accessing resources via HTTP, it doesn't provide the full flexibility or functionality needed by many applications. HttpClient seeks to fill this void by providing an efficient, up-to-date, and feature-rich package implementing the client side of the most recent HTTP standards and recommendations.<br /><br />"Designed for extension while providing robust support for the base HTTP protocol, HttpClient may be of interest to anyone building HTTP-aware client applications such as web browsers, web service clients, or systems that leverage or extend the HTTP protocol for distributed communication".</blockquote><br /><br /><embed border="1" height="500" src="https://hc.apache.org/httpcomponents-client-ga/tutorial/pdf/httpclient-tutorial.pdf" width="550"></embed> <br /><h3>What Does Http Client Do?</h3><blockquote class="tr_bq" style="font-size: medium; font-weight: normal;"><br />"The most essential function of HttpClient is to execute HTTP methods. Execution of an HTTP method involves one or several HTTP request / HTTP response exchanges, usually handled internally by HttpClient. The user is expected to provide a request object to execute and HttpClient is expected to transmit the request to the target server return a corresponding response object, or throw an exception if execution was unsuccessful.<br />"Quite naturally, the main entry point of the HttpClient API is the HttpClient interface that defines the contract described above".</blockquote><br /><h3>Parts of a URI</h3><br />A web address or URL -- Universal Resource Locator -- is a type of Uniform Resource Identifier, one that points to a physical location such as a server. A URI, though, is more abstract.<br /><br />There are many parts to a URI as shown below:  <br /><br /><span style="background-color: #f9f9f9; font-family: monospace , &quot;courier&quot;; font-size: 14px; line-height: 1.3em; white-space: pre-wrap;"> </span><b style="font-family: monospace, Courier; font-size: 14px; line-height: 1.3em; white-space: pre-wrap;">scheme</b><span style="background-color: #f9f9f9; font-family: monospace , &quot;courier&quot;; font-size: 14px; line-height: 1.3em; white-space: pre-wrap;">:[</span><b style="font-family: monospace, Courier; font-size: 14px; line-height: 1.3em; white-space: pre-wrap;">//</b><span style="background-color: #f9f9f9; font-family: monospace , &quot;courier&quot;; font-size: 14px; line-height: 1.3em; white-space: pre-wrap;">[</span><b style="font-family: monospace, Courier; font-size: 14px; line-height: 1.3em; white-space: pre-wrap;">user:password@</b><span style="background-color: #f9f9f9; font-family: monospace , &quot;courier&quot;; font-size: 14px; line-height: 1.3em; white-space: pre-wrap;">]</span><b style="font-family: monospace, Courier; font-size: 14px; line-height: 1.3em; white-space: pre-wrap;">host</b><span style="background-color: #f9f9f9; font-family: monospace , &quot;courier&quot;; font-size: 14px; line-height: 1.3em; white-space: pre-wrap;">[</span><b style="font-family: monospace, Courier; font-size: 14px; line-height: 1.3em; white-space: pre-wrap;">:port</b><span style="background-color: #f9f9f9; font-family: monospace , &quot;courier&quot;; font-size: 14px; line-height: 1.3em; white-space: pre-wrap;">]][</span><b style="font-family: monospace, Courier; font-size: 14px; line-height: 1.3em; white-space: pre-wrap;">/</b><span style="background-color: #f9f9f9; font-family: monospace , &quot;courier&quot;; font-size: 14px; line-height: 1.3em; white-space: pre-wrap;">]</span><b style="font-family: monospace, Courier; font-size: 14px; line-height: 1.3em; white-space: pre-wrap;">path</b><span style="background-color: #f9f9f9; font-family: monospace , &quot;courier&quot;; font-size: 14px; line-height: 1.3em; white-space: pre-wrap;">[?</span><b style="font-family: monospace, Courier; font-size: 14px; line-height: 1.3em; white-space: pre-wrap;">query</b><span style="background-color: #f9f9f9; font-family: monospace , &quot;courier&quot;; font-size: 14px; line-height: 1.3em; white-space: pre-wrap;">][#</span><b style="font-family: monospace, Courier; font-size: 14px; line-height: 1.3em; white-space: pre-wrap;">fragment</b><span style="background-color: #f9f9f9; font-family: monospace , &quot;courier&quot;; font-size: 14px; line-height: 1.3em; white-space: pre-wrap;">]</span>&nbsp; <br /><br /><ul><li><b>Scheme</b>: Can be web based (<i>http</i> or <i>https</i>), Transporting a file (<i>ftp</i>), or even an email (<i>mailto</i>). The Internet Assigned Numbers Authority keeps track of all schemes. ( <a href="http://www.iana.org/assignments/uri-schemes/uri-schemes.xhtml" target="_blank">LINK</a> ).</li><li><b>Authority</b>:&nbsp;</li><ul><li>Optional username, or the username &amp; password.</li><li><b>Host</b>, such as the domain name, registered name or hostname</li><li>Optional <b>port</b> name such as :8088.</li></ul><li><b>Path:</b><i>&nbsp;</i>The subdirectory, such as&nbsp;<i>/v1/charges.</i>&nbsp;</li><li><b>Query</b>: Everything starting with the <i>?</i> symbol in the URI is a query.&nbsp;</li><ul><li>URIBuilder then allows you to add names and values to <b>Parameters</b>, such as <i>key</i> and <i>sk_test</i> or <i>limit</i> and <i>3</i>.</li></ul></ul><h3>Get the Last Three Charges</h3><br />Let's say you want to retrieve a list of charges from the API is passing into the getListOfCharges how many charge orders to get. What is the limit? One? Two? Five? Eight?<br /><br />If we were manually testing if the API can retrieve the last <i>three</i> charges, we would enter the following code into our web browser to form the HTTP GET statement...<br /><br /><pre class=" hljs language-bash" style="background: rgb(39, 43, 45); border-radius: 5px; border: 0px; color: #d0d0d0; direction: ltr; font-family: 'source code pro', menlo, monospace; font-size: 13px; line-height: 1.5em; outline: 0px; padding: 20px 40px; vertical-align: baseline; white-space: pre-wrap; word-break: normal;"><code class=" language-bash" style="border: 0px; direction: ltr; font-family: inherit; font-style: inherit; font-weight: inherit; margin: 0px; outline: 0px; padding: 0px; tab-size: 4; vertical-align: baseline; word-break: normal; word-spacing: normal;"><span class="token request-url" style="border: 0px; color: #c1ef65; font-family: inherit; font-style: inherit; font-weight: inherit; margin: 0px; outline: 0px; padding: 0px; vertical-align: baseline;">https://api.stripe.com/v1/charges?limit=3&amp;key=sk_test_BQokikJOvBiI2HlWgH4olfQ2</span></code></pre><br />... And place the JSON parameters into something such as an Excel spreadsheet.<br /><br />Instead we are going to use Apache Http Components to do the work for us. We are going to:<br /><br /><ul><li>&nbsp;Break the URI into different pieces and validate them with <b>URIBuilder</b>.&nbsp;</li><li>Add the URI into a <b>HttpGet</b> class.</li><li>Instantiate a new <b>BasicCredentialsProvider</b> class, and set credentials with the Stripe API key.&nbsp;</li><li>Create using <b>HttpBuilder</b> an HTTP call holding the credentials.</li><li>Store the call in a <b>CloseableHttpClient</b>.</li><li>Execute the HttpGet statement, storing the results in a <b>HttpResponse</b> class.&nbsp;</li><li>Examine the response's status line and status code to see if it the status was OK, with a value of "200". If not, we are going to throw an error.&nbsp;</li></ul><br />Got that? ... No? Okay, we are going to walk through this again... We went through so many steps, I even lost myself!<br /><h4><br />URIBuilder</h4><br />We are going to use URI Builder to construct the URI we will be using to connect to the API:<br /><ul><li>Set the scheme to be https.</li><li>Set the host to be api.stripe.com.&nbsp;</li><li>Set the path to be /v1/charges.</li><li>Set the parameter "limit" to be whatever limit has been passed.</li></ul><pre style="background: rgb(240, 240, 240); border: 1px dashed rgb(204, 204, 204); font-family: arial; font-size: 12px; height: auto; line-height: 20px; overflow: auto; padding: 0px; width: 646.469px;"><code style="word-wrap: normal;">URIBuilder uriBuilder = new URIBuilder();  <br />     uriBuilder.setScheme("https")  <br />       .setHost("api.stripe.com")  <br />       .setPath("/v1/charges")  <br />       .setParameter("limit", limit.toString();  </code></pre><h4><span style="font-weight: normal;">...Why use URI Builder instead of feeding the straight URL into the API? Validation:</span></h4><ul><li>If you accidentally have a blank space in the URL, it will tell you exactly where there is an Illegal Character.&nbsp;</li></ul><h4>HttpGet</h4>We are going to try the following:  <br /><ul><li>Build the URI according to the parameters we set up.&nbsp;</li><li>Compose an HTTP GET Method based on the URI.&nbsp;</li><li>Set up using BasicCrendentialsProvider the UsernamePasswordCredentials. We will add the Stripe API Key here.&nbsp;</li><li>We then build with HttpClientBuilder and instantiate with CloseableHttpClient the credentials.&nbsp;</li><li>Finally, we execute the Http Client using the HttpGet statement we set up.&nbsp;</li></ul><pre style="background: rgb(240, 240, 240); border: 1px dashed rgb(204, 204, 204); font-family: arial; font-size: 12px; height: auto; line-height: 20px; overflow: auto; padding: 0px; width: 646.469px;"><code style="word-wrap: normal;">URI uri = uriBuilder.build();  <br />       HttpGet httpGet = new HttpGet(uri);  <br />       BasicCredentialsProvider credentialsProvider = new BasicCredentialsProvider();  <br />       credentialsProvider.setCredentials(AuthScope.ANY, new UsernamePasswordCredentials(Stripe.apiKey, ""));  <br />       CloseableHttpClient client = HttpClientBuilder.create().setDefaultCredentialsProvider(credentialsProvider).build();  <br />       HttpResponse response = client.execute(httpGet);  </code></pre><br /><h3></h3><h4>Check Status Code</h4>Are there problems? Is the response anything but 200-OK? We are going to throw an error.<br /><br /><pre style="background: rgb(240, 240, 240); border: 1px dashed rgb(204, 204, 204); font-family: arial; font-size: 12px; height: auto; line-height: 20px; overflow: auto; padding: 0px; width: 646.469px;"><code style="word-wrap: normal;">if (statusCode != 200) {  <br />         String errorMessage = "ERROR: Attempting to Capture Charge: " + statusCode + "\n"  <br />           + "Reason: " +  <br />           response.getStatusLine().getReasonPhrase();  <br />         throw new TestException (errorMessage); </code></pre><br /><br /><h4>Convert Results into String</h4>If everything is successful, we are going to&nbsp;  <br /><ul><li>Take that response and get the entity.&nbsp;</li><li>Convert the entity into a String format, using EntityUtils.toString.&nbsp;</li></ul><br /><pre style="background: rgb(240, 240, 240); border: 1px dashed rgb(204, 204, 204); font-family: arial; font-size: 12px; height: auto; line-height: 20px; overflow: auto; padding: 0px; width: 646.469px;"><code style="word-wrap: normal;">String json = EntityUtils.toString(response.getEntity()); </code></pre><br /><br /><h4>Use GSON</h4><br />Once we have the JSON Feed as a String, we are going to use Google's GSON library to take the String and place it in the CollectionOfCharges class we just created.<br /><br /><pre style="background: rgb(240, 240, 240); border: 1px dashed rgb(204, 204, 204); font-family: arial; font-size: 12px; height: auto; line-height: 20px; overflow: auto; padding: 0px; width: 646.469px;"><code style="word-wrap: normal;">chargesRetrieved = gson.fromJson(json, CollectionOfCharges.class);</code></pre><br />... we will go over GSON a few blog posts from now.<br /><h4><br />Check for Errors</h4><br />If there is anything wrong with: <br /><ul><li>URI Synatax ... a URI Syntax Exception is thrown.</li><li>If input or output cannot be read, an IOException is thrown.</li></ul>A&nbsp;<a href="http://docs.oracle.com/javase/6/docs/api/java/net/URISyntaxException.html?is-external=true" target="_blank">URISyntaxException</a> &nbsp;will tell you what exactly was messed up, returning the String, the reason for the error, and exactly where the error occurred.<br /><br /><br />... We are going to print a stack trace so we can figure out what went wrong.<br /><br /><pre style="background: rgb(240, 240, 240); border: 1px dashed rgb(204, 204, 204); font-family: arial; font-size: 12px; height: auto; line-height: 20px; overflow: auto; padding: 0px; width: 646.469px;"><code style="word-wrap: normal;">catch (URISyntaxException e) {  <br />       e.printStackTrace();  <br />     } catch (IOException e) {  <br />       e.printStackTrace();  </code></pre><br />Putting it all together, our code looks like:&nbsp; <br />Adding &nbsp;<b>getListOfCharges</b>&nbsp;to&nbsp;<b>StripeUtils.java</b>.<br /><pre style="background: rgb(240, 240, 240); border: 1px dashed rgb(204, 204, 204); font-family: arial; font-size: 12px; height: auto; line-height: 20px; overflow: auto; padding: 0px; width: 646.469px;"><code style="word-wrap: normal;"> public CollectionOfCharges getListOfCharges(Integer limit){  <br />     CollectionOfCharges chargesRetrieved = new CollectionOfCharges();  <br />     Gson gson = new Gson();  <br />     URIBuilder uriBuilder = new URIBuilder();  <br />     uriBuilder.setScheme("https")  <br />       .setHost("api.stripe.com")  <br />       .setPath("/v1/charges")  <br />       .setParameter("limit", limit.toString());  <br />     try {  <br />       URI uri = uriBuilder.build();  <br />       HttpGet httpGet = new HttpGet(uri);  <br />       BasicCredentialsProvider credentialsProvider = new BasicCredentialsProvider();  <br />       credentialsProvider.setCredentials(AuthScope.ANY, new UsernamePasswordCredentials(Stripe.apiKey, ""));  <br />       CloseableHttpClient client = HttpClientBuilder.create().setDefaultCredentialsProvider(credentialsProvider).build();  <br />       HttpResponse response = client.execute(httpGet);  <br />       int statusCode = response.getStatusLine().getStatusCode();  <br />       if (statusCode != 200) {  <br />         String errorMessage = "ERROR: Attempting to Capture Charge: " + statusCode + "\n"  <br />           + "Reason: " +  <br />           response.getStatusLine().getReasonPhrase();  <br />         throw new TestException (errorMessage);  <br />       }  <br />       String json = EntityUtils.toString(response.getEntity());  <br />       chargesRetrieved = gson.fromJson(json, CollectionOfCharges.class);  <br />       client.close();  <br />     } catch (URISyntaxException e) {  <br />       e.printStackTrace();  <br />     } catch (IOException e) {  <br />       e.printStackTrace();  <br />     }  <br />     return chargesRetrieved;  <br />   }  <br /></code></pre><br /><br /><h3>Writing an API Test</h3><br />If you go back to Stripe API Documentation, where it says <a href="https://stripe.com/docs/api#list_charges" target="_blank">List Charges</a>, you will see the following:<br /><br /><pre class=" language-json" style="background: rgb(39, 43, 45); border-radius: 5px; border: 0px; color: #d0d0d0; direction: ltr; font-family: 'Source Code Pro', Menlo, monospace; font-size: 13px; line-height: 1.5em; outline: 0px; padding: 20px 40px; tab-size: 4; vertical-align: baseline; white-space: pre-wrap; word-break: normal;"><code class=" language-json" style="border: 0px; direction: ltr; font-family: inherit; font-style: inherit; font-weight: inherit; margin: 0px; outline: 0px; padding: 0px; tab-size: 4; vertical-align: baseline; word-break: normal; word-spacing: normal;"><span class="token punctuation" style="border: 0px; color: #d0d4d7; font-family: inherit; font-style: inherit; font-weight: inherit; margin: 0px; outline: 0px; padding: 0px; vertical-align: baseline;">{</span><span class="token json-key" style="border: 0px; color: #c1ef65; font-family: inherit; font-style: inherit; font-weight: inherit; margin: 0px; outline: 0px; padding: 0px; vertical-align: baseline;"><br />  "object"</span><span class="token punctuation" style="border: 0px; color: #d0d4d7; font-family: inherit; font-style: inherit; font-weight: inherit; margin: 0px; outline: 0px; padding: 0px; vertical-align: baseline;">:</span> <span class="token json-string" style="border: 0px; font-family: inherit; font-style: inherit; font-weight: inherit; margin: 0px; outline: 0px; padding: 0px; vertical-align: baseline;">"list"</span><span class="token punctuation" style="border: 0px; color: #d0d4d7; font-family: inherit; font-style: inherit; font-weight: inherit; margin: 0px; outline: 0px; padding: 0px; vertical-align: baseline;">,</span><span class="token json-key" style="border: 0px; color: #c1ef65; font-family: inherit; font-style: inherit; font-weight: inherit; margin: 0px; outline: 0px; padding: 0px; vertical-align: baseline;"><br />  "url"</span><span class="token punctuation" style="border: 0px; color: #d0d4d7; font-family: inherit; font-style: inherit; font-weight: inherit; margin: 0px; outline: 0px; padding: 0px; vertical-align: baseline;">:</span> <span class="token json-string" style="border: 0px; font-family: inherit; font-style: inherit; font-weight: inherit; margin: 0px; outline: 0px; padding: 0px; vertical-align: baseline;">"/v1/charges"</span><span class="token punctuation" style="border: 0px; color: #d0d4d7; font-family: inherit; font-style: inherit; font-weight: inherit; margin: 0px; outline: 0px; padding: 0px; vertical-align: baseline;">,</span></code></pre><br />... The name "object" should return the value "list". The name "url" should return "/v1/charges".<br /><br />Let's make that the test!<br /><br />First let's see if that is what is returned, with a quick little test we can put in the Stripe.java test class we created in the testcases folder during our last blog. <br /><br /><pre style="background: #f0f0f0; border: 1px dashed #cccccc; color: black; font-family: &quot;arial&quot;; font-size: 12px; height: auto; line-height: 20px; overflow: auto; padding: 0px; text-align: left; width: 99%;"><code style="color: black; word-wrap: normal;"> @Test  <br />   public void test_printCollectionOfChargesParameters(){  <br />     Integer numberOfChargesReturned = 2;  <br />     StripeUtils stripe = new StripeUtils(Locale.US);  <br />     CollectionOfCharges charges = stripe.getListOfCharges(numberOfChargesReturned);  <br />     System.out.println("Object: " + charges.getObject());  <br />     System.out.println("URL: " + charges.getUrl());  <br />   }  <br /></code></pre><br />Running this test we get:<br /><br /><pre style="background: #f0f0f0; border: 1px dashed #cccccc; color: black; font-family: &quot;arial&quot;; font-size: 12px; height: auto; line-height: 20px; overflow: auto; padding: 0px; text-align: left; width: 99%;"><code style="color: black; word-wrap: normal;"> [TestNG] Running:  <br />  C:\Users\tmaher\.IdeaIC15\system\temp-testng-customsuite.xml  <br /> Object: list  <br /> URL: /v1/charges  <br />   <br /> ===============================================  <br /> Default Suite  <br /> Total tests run: 1, Failures: 0, Skips: 0  <br /> ===============================================  <br /></code></pre><br />... We now can absolutely confirm the output matches the documentation -- Always a good thing!<br /><br />Let's changes the print statements to assert statements...<br /><br />... And also refactor the <i>getObject</i> to <i>getObjectType</i>. The charge objects are stored in "data". It seems to be more of an object type that an actual object, so let's name it as such. With IntelliJ, I can<i> Refactor -&gt; Rename</i>, and the name of the method gets changed everywhere in our automated test.<br /><br /><pre style="background: #f0f0f0; border: 1px dashed #cccccc; color: black; font-family: &quot;arial&quot;; font-size: 12px; height: auto; line-height: 20px; overflow: auto; padding: 0px; text-align: left; width: 99%;"><code style="color: black; word-wrap: normal;"> @Test  <br />   public void test_returnedCollectionOfChargesParameters(){  <br />     String expectedObjectType = "list";  <br />     String expectedUrl = "/v1/charges";  <br />     Integer numberOfChargesReturned = 2;  <br />     StripeUtils stripe = new StripeUtils(Locale.US);  <br />     CollectionOfCharges charges = stripe.getListOfCharges(numberOfChargesReturned);  <br />     assertEquals(charges.getObjectType(), expectedObjectType);  <br />     assertEquals(charges.getUrl(), expectedUrl);  <br />   }  <br /></code></pre><br />Hrm. I still am not happy with it. This test? It'll run, and it will pass or fail depending on if the expected parameters matches what is actually captured, but I prefer some type of logging explicitly spelling out exactly:<br /><br /><ul><li>What is the test is supposed to do?</li><li>What is the expected output?</li><li>What is the actual mark?&nbsp;</li><li>In plain English, does it (PASS) or does it (FAIL)?</li></ul><br />The assert statement isn't enough for me. Let's borrow some code I whipped up in my last project to handle reporting, and place it in the test class. <br /><br /><b>checkMatchingValues:</b><br /><pre style="background: #f0f0f0; border: 1px dashed #cccccc; color: black; font-family: &quot;arial&quot;; font-size: 12px; height: auto; line-height: 20px; overflow: auto; padding: 0px; text-align: left; width: 99%;"><code style="color: black; word-wrap: normal;"> private boolean checkMatchingValues(String testHeading, Object actualValue, Object expectedValue) {  <br />     String successMessage = "\t* The Expected and Actual Values match. (PASS)\n";  <br />     String failureMessage = "\t* The Expected and Actual Values do not match! (FAIL)\n";  <br />   <br />     boolean doValuesMatch = false;  <br />   <br />     System.out.println(testHeading);  <br />     System.out.println("\t* Expected Value: " + expectedValue);  <br />     System.out.println("\t* Actual Value: " + actualValue);  <br />   <br />     if (actualValue.equals(expectedValue)) {  <br />       System.out.println(successMessage);  <br />       doValuesMatch = true;  <br />     } else {  <br />       System.out.println(failureMessage);  <br />       doValuesMatch = false;  <br />     }  <br />     return doValuesMatch;  <br />   }  <br />   <br /></code></pre><br />... Now, I might be able to get the output I like to see.<br /><br />The new test looks like:<br /><br /><pre style="background: #f0f0f0; border: 1px dashed #cccccc; color: black; font-family: &quot;arial&quot;; font-size: 12px; height: auto; line-height: 20px; overflow: auto; padding: 0px; text-align: left; width: 99%;"><code style="color: black; word-wrap: normal;"> @Test  <br />   public void test_returnedCollectionOfChargesParameters(){  <br />     String expectedObjectType = "list";  <br />     String expectedUrl = "/v1/charges";  <br />     Integer numberOfChargesReturned = 2;  <br />     StripeUtils stripe = new StripeUtils(Locale.US);  <br />     CollectionOfCharges charges = stripe.getListOfCharges(numberOfChargesReturned);  <br />   <br />     String actualObjectType = charges.getObjectType();  <br />     checkMatchingValues("Verify that the Returned Collection Object types match", actualObjectType, expectedObjectType);  <br />     assertEquals(actualObjectType, expectedObjectType, "ERROR: The Object types do not match!");  <br />   <br />     String actualUrl = charges.getUrl();  <br />     checkMatchingValues("Verify that the Returned Collection URLs match", actualUrl, expectedUrl);  <br />     assertEquals(actualUrl, expectedUrl, "ERROR: The urls do not match!");  <br />   }  <br /></code></pre><br />... And the output of the test looks like ...<br /><pre style="background: #f0f0f0; border: 1px dashed #cccccc; color: black; font-family: &quot;arial&quot;; font-size: 12px; height: auto; line-height: 20px; overflow: auto; padding: 0px; text-align: left; width: 99%;"><code style="color: black; word-wrap: normal;"> [TestNG] Running:  <br />  C:\Users\tmaher\.IdeaIC15\system\temp-testng-customsuite.xml  <br /> Verify that the Returned Collection Object types match  <br />      * Expected Value: list  <br />      * Actual Value: list  <br />      * The Expected and Actual Values match. (PASS)  <br />   <br /> Verify that the Returned Collection URLs match  <br />      * Expected Value: /v1/charges  <br />      * Actual Value: /v1/charges  <br />      * The Expected and Actual Values match. (PASS)  <br />   <br />   <br /> ===============================================  <br /> Default Suite  <br /> Total tests run: 1, Failures: 0, Skips: 0  <br /> ===============================================  <br /></code></pre><br />Nice output. It's clear cut. You know exactly what is being tested. Call it the manual tester in me, but I get suspicious of positive results as much as negative results. If everything is spelled out, it is easier to spot an error.<br /><br />If you want to examine the code, it can be viewed on GitHub at&nbsp;<a href="https://github.com/tjmaher/RESTful_Testing_Using_Stripe">https://github.com/tjmaher/RESTful_Testing_Using_Stripe</a>.<br /><br />Next week, we will examine Google GSON more closely, and write a few more Stripe tests on capturing charges.<br /><br style="background-color: white; color: #222222; font-family: Calibri; font-size: 15.4px; line-height: 21.56px;" /><img alt="" src="http://feedburner.google.com/fb/images/pub/feed-icon16x16.png" style="background: rgb(255, 255, 255); border: 0px; box-shadow: rgba(0, 0, 0, 0.0980392) 1px 1px 5px; color: #222222; font-family: Calibri; font-size: 15.4px; line-height: 21.56px; padding: 5px; vertical-align: middle;" /><span style="background-color: white; color: #222222; font-family: &quot;calibri&quot;; font-size: 15.4px; line-height: 21.56px;">&nbsp;&nbsp;</span><b style="background-color: white; color: #222222; font-family: Calibri; font-size: 15.4px; line-height: 21.56px;">Subscribe to Blog:</b><span style="background-color: white; color: #222222; font-family: &quot;calibri&quot;; font-size: 15.4px; line-height: 21.56px;">&nbsp;</span><br /><ul style="background-color: white; color: #222222; font-family: Calibri; font-size: 15.4px; line-height: 21.56px; margin: 0.5em 0px; padding: 0px 2.5em;"><li style="margin: 0px 0px 0.25em; padding: 0px;"><a href="http://feeds.feedburner.com/AdventuresInAutomation" rel="alternate" style="color: #888888; text-decoration: none;" type="application/rss+xml"></a><a href="http://feeds.feedburner.com/AdventuresInAutomation" rel="alternate" style="color: #888888; text-decoration: none;" type="application/rss+xml">Via RSS Feed</a></li><li style="margin: 0px 0px 0.25em; padding: 0px;"><a href="https://feedburner.google.com/fb/a/mailverify?uri=AdventuresInAutomation" style="color: #888888; text-decoration: none;">Via Email</a></li></ul><br />Until then, happy testing!<br /><br><b>NEXT: </b><a href="/2016/02/restful-testing-with-stripe-from-json.html">From JSON to Object: HttpEntity and GSON</a></li><br><br><br /><div class="toc-section" id="toc-section"><b>RESTful Testing with Stripe:</b><ul><li><a href="/2016/02/coming-up-how-to-work-with-rest-apis.html">Introduction</a></li><li><b>Part One:</b>&nbsp;<a href="/2016/02/restful-testing-with-stripe-brief.html">Intro to REST APIs</a></li><li><b>Part Two:</b>&nbsp;<a href="/2016/02/restful-testing-with-stripe-interacting.html">Interacting with Stripe using HTTPS and cURL</a></li><li><b>Part Three:</b>&nbsp;<a href="/2016/02/restful-testing-with-stripe-storing-api_23.html">API Keys, Property files, and Initial Setup</a></li><li><b>Part Four:</b>&nbsp;<a href="/2016/02/restful-testing-with-stripe-using.html">UriBuilder, HttpGet and other Apache HttpComponents</a></li><li><b>Part Five:</b>&nbsp;<a href="/2016/02/restful-testing-with-stripe-from-json.html">From JSON to Object: HttpEntity and GSON</a></li><li><b>Source Code:</b>&nbsp;<a href="https://github.com/tjmaher/RESTful_Testing_Using_Stripe">GitHub, T.J. Maher</a></li></ul></div><br /><br><span style="background-color: white; color: #222222; font-family: &quot;calibri&quot;; font-size: 15.4px; line-height: 21.56px;">-T.J. Maher</span><br /><div style="background-color: white; color: #222222; font-family: Calibri; font-size: 15.4px; line-height: 21.56px;"><i style="font-family: calibri; font-size: 15.4px; line-height: 21.56px;">&nbsp;Sr. QA Engineer, Fitbit</i><br /><i style="font-family: calibri; font-size: 15.4px; line-height: 21.56px;">&nbsp;Boston, MA</i></div><div style="background-color: white; color: #222222; font-family: Calibri; font-size: 15.4px; line-height: 21.56px;"><i style="font-family: calibri; font-size: 15.4px; line-height: 21.56px;"><br /></i></div><div style="background-color: white; color: #222222; font-family: Calibri; font-size: 15.4px; line-height: 21.56px;"><i style="font-family: calibri; font-size: 15.4px; line-height: 21.56px;">// Automated tester for [ 11 ] month and counting!</i><br /><i style="font-family: calibri; font-size: 15.4px; line-height: 21.56px;"><br /></i><i style="font-family: calibri; font-size: 15.4px; line-height: 21.56px;">Please note: 'Adventures in Automation' is a personal blog about automated testing. It is not an official blog of&nbsp;<a href="http://www.fitbit.com/" style="color: #888888; text-decoration: none;" target="_blank">Fitbit.com</a>.&nbsp;</i></div>