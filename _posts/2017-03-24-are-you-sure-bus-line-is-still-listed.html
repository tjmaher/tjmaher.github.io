---
layout: post
title: 'Are you sure the bus line is still listed?: Interacting with the MBTA''s API
  using REST Assured'
date: '2017-03-24T19:42:00.001-04:00'
author: T.J. Maher
tags:
- Rest API
- REST Assured
modified_time: '2018-02-27T22:39:38.395-05:00'
thumbnail: https://4.bp.blogspot.com/-lFlZLvPfUUg/WKDFiTiKUII/AAAAAAAALno/nDSWYPMBi0oqkhpbwsHTTcc3210yS74-wCLcB/s72-c/T.png
blogger_id: tag:blogger.com,1999:blog-3868566217808655382.post-1905930021753303033
blogger_orig_url: http://www.tjmaher.com/2017/03/are-you-sure-bus-line-is-still-listed.html
---

<i>This is the second part of a blog series on REST APIs and the REST Assured Java library. Did you want to go <a href="http://www.tjmaher.com/2017/02/are-you-sure-bus-line-still-listed.html" target="_blank">back to the beginning</a>?</i><br /><br />Let's say you are an automation developer on a team developing in Java a new public transportation web application. The customer base for the app is located in Southeastern Massachusetts in the United States. <br /><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="https://4.bp.blogspot.com/-lFlZLvPfUUg/WKDFiTiKUII/AAAAAAAALno/nDSWYPMBi0oqkhpbwsHTTcc3210yS74-wCLcB/s1600/T.png" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" height="200" src="https://4.bp.blogspot.com/-lFlZLvPfUUg/WKDFiTiKUII/AAAAAAAALno/nDSWYPMBi0oqkhpbwsHTTcc3210yS74-wCLcB/s200/T.png" width="200" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;"><i>The MBTA system in Massachusetts controls buses, subways and commuter rail in Boston and its suburbs.<br />The subway system is collectively known as "The T", as in "Taking the T into Boston" or "The T is running slow... again!" and is divided into the Red, Green, and Orange Line, with a bus route called the Silver Line.&nbsp;</i></td></tr></tbody></table><div><br /></div><div>How can you prove that the #230 bus line, running from the Montello Commuter Rail in Brockton, MA to Braintree MBTA station all the way to Quincy Center Station is still listed in the system?</div><div><br /></div><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="https://3.bp.blogspot.com/-qqCWiopKUGo/WKDDrAFWD2I/AAAAAAAALnc/T3gNzwi5vVU6hDiy6L9nV1c0X7eOFh4PgCLcB/s1600/MBTA%2BBus%2B230%2Bin%2BQuincy.JPG" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" height="300" src="https://3.bp.blogspot.com/-qqCWiopKUGo/WKDDrAFWD2I/AAAAAAAALnc/T3gNzwi5vVU6hDiy6L9nV1c0X7eOFh4PgCLcB/s400/MBTA%2BBus%2B230%2Bin%2BQuincy.JPG" width="400" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;"><i>Are you sure this bus line is still listed in the system? If not, it's a bug.</i></td></tr></tbody></table><br /><a name='more'></a><br /><br /><a href="http://www.tjmaher.com/2017/02/are-you-sure-bus-line-still-listed.html">With the last blog entry</a>, we described why getting this information from the MBTA website &lt;<a href="http://www.mbta.com/">http://www.mbta.com/</a>&gt; would not be the best solution. We also covered how using the MBTA's Application Program Interface (API), MBTA-Realtime &lt;<a href="http://realtime.mbta.com/Portal/">http://realtime.mbta.com/Portal/</a>&gt;, we can easily get the information by:<br /><ul><li>Going to <a href="http://realtime.mbta.com/developer/api/v2/routes?api_key=wX9NwuHnZU2ToO7GmGR9uw&amp;format=json">http://realtime.mbta.com/developer/api/v2/routes?api_key=wX9NwuHnZU2ToO7GmGR9uw&amp;format=json</a> to view all routes, and eyeball that "route_id : 230" is still there.&nbsp;</li><li>The MBTA API team graciously provides a public access key, wX9NwuHnZU2ToO7GmGR9uw, that we can use to play around with their system. This Public API key can change at any time. If the key no longer works, check out the <a href="http://realtime.mbta.com/Portal/Home/Download">MBTA Developer Portal Download</a> section to find out the new key.&nbsp;</li><li>Of course, if you are creating a web or mobile app for real, <a href="http://realtime.mbta.com/Portal/Account/Register">Register for a free API key</a>.&nbsp;</li></ul><br />But how could we turn this into an automated test? <br /><br />Last year, we talked about how to interact with RESTful APIs with <a href="http://www.tjmaher.com/2016/02/restful-testing-with-stripe-brief.html">Apache Http Components</a>, or with <a href="http://www.tjmaher.com/2016/07/introduction-to-api-testing-with.html">Postman</a>. With this blog post we are going to use <b>REST Assured</b>, referred to me by automation development consultants Alan Richardson and Baz Dijkstra.<br /><br /><b>Alan Richardson:</b><br /><blockquote class="twitter-tweet" data-lang="en"><div dir="ltr" lang="en"><a href="https://twitter.com/tjmaher1">@tjmaher1</a> <a href="https://twitter.com/TourDeDave">@TourDeDave</a> I start with RestAssured and I use HttpClient. I'm going to investigate Unirest soon.</div>— Alan Richardson (@eviltester) <a href="https://twitter.com/eviltester/status/783916918063394816">October 6, 2016</a></blockquote><script async="" charset="utf-8" src="//platform.twitter.com/widgets.js"></script> <b><br /></b><b>Baz Dijkstra:</b><br /><blockquote class="twitter-tweet" data-lang="en"><div dir="ltr" lang="en"><a href="https://twitter.com/tjmaher1">@tjmaher1</a> you're welcome! Feel free to put it to good use :) Would love to hear how your demo went</div>— Bas Dijkstra (@_basdijkstra) <a href="https://twitter.com/_basdijkstra/status/797401612381814784">November 12, 2016</a></blockquote><script async="" charset="utf-8" src="//platform.twitter.com/widgets.js"></script> <br /><br /><h2>What is REST Assured?</h2>REST Assured &lt;<a href="https://github.com/rest-assured/rest-assured" target="_blank">https://github.com/rest-assured/rest-assured</a>&gt; was developed as a Java library to handle complex interaction with a REST API simply. According to the REST Assured site at &lt;<a href="http://rest-assured.io/" target="_blank">http://rest-assured.io/</a>&gt;:<br /><br /><i>"REST Assured is developed and maintained by <a href="https://twitter.com/johanhaleby">Johan Haleby</a> with the help of numerous other <a href="https://github.com/rest-assured/rest-assured/contributors">contributors</a> over the years. Would you like to contribute to the project in any way? Submit a <a href="https://github.com/rest-assured/rest-assured">pull request</a> or contact Johan at <a href="https://twitter.com/johanhaleby">Twitter</a>.</i><br /><div><i><br /></i><i>"Johan started the project when he was working at <a href="https://www.jayway.com/">Jayway</a> back in December of 2010. The project is now sponsored by <a href="https://www.parkster.se/">Parkster</a>".&nbsp;</i><br /><br />Johan is currently a&nbsp;<span style="background-color: white; color: #333333; font-family: inherit; font-size: 16px; font-style: inherit; font-weight: inherit;">Senior Software Developer and Architect at Parkster AB in Sweden. REST Assured is up to&nbsp;</span>version 3.0.3 released on January 20, 2016.<br /><div class="demographic-info adr editable-item" id="demographics" style="background-color: white; border: 0px; color: #66696a; font-family: Helvetica, FreeSans, &quot;Liberation Sans&quot;, Helmet, Arial, sans-serif; font-size: 13px; font-stretch: inherit; font-variant-numeric: inherit; line-height: 17px; margin: 2px 0px; padding: 0px; text-size-adjust: 100%; vertical-align: baseline;"><div data-li-template="location" id="location-container" style="border: 0px; font-family: inherit; font-stretch: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; line-height: inherit; margin: 0px; padding: 0px; text-size-adjust: 100%; vertical-align: baseline;"></div></div><br /><h2>Need help API Testing with REST Assured?&nbsp;</h2><br />On REST Assured's official site &lt;<a href="http://rest-assured.io/" target="_blank">http://rest-assured.io/</a>&gt; it this lists this note, dated June 17, 2016:<br /><ul><li><i>"<a href="https://www.linkedin.com/in/basdijkstra">Bas Dijkstra</a> has been generous enough to open source his REST Assured workshop. You can read more about this <a href="http://www.ontestautomation.com/open-sourcing-my-workshop-an-experiment/">here</a> and you can try out, and contribute to, the exercises available in <a href="https://github.com/basdijkstra/workshops/">his</a> github repository".</i></li></ul>According to Bas' article, <a href="https://techbeacon.com/efficient-api-testing-how-get-started-rest-assured" target="_blank">Efficient API testing: How to get started with REST Assured</a>&nbsp;published in TechBeacon&nbsp;<i>(Feb 8, 2017), </i>there are three main reasons for using REST Assured, instead of doing it yourself:<br /><ul><li><i>"It removes the need for writing a lot of boilerplate code required to set up an HTTP connection, send a request and receive and parse a response</i></li><li><i>"It supports a Given/When/Then test notation, which instantly makes your tests human readable</i></li><li><i>"Since REST Assured is a Java library, integrating it into a continuous integration / continuous delivery setup is a breeze, especially when combined with a Java testing framework such as JUnit or TestNG"</i></li></ul><h2></h2><h2>How Could We Interact With MBTA's API With REST Assured?</h2>Testing the application through the API -- and not the web user interface -- means that we can test the system quickly and easily without having to wait for a browser.<br /><br />We can test that:<br /><br /><ul><li>Entering the public API Key, that we get the HTTP Status Code of OK: 200. See&nbsp;<a href="http://realtime.mbta.com/developer/api/v2/routes?api_key=wX9NwuHnZU2ToO7GmGR9uw&amp;format=json">http://realtime.mbta.com/developer/api/v2/routes?api_key=wX9NwuHnZU2ToO7GmGR9uw&amp;format=json</a>&nbsp;</li><li>We cannot access the data without the correct API Key: See&nbsp;<a href="http://realtime.mbta.com/developer/api/v2/routes?format=json" target="_blank">http://realtime.mbta.com/developer/api/v2/routes?format=json</a></li><li>If we so choose, we can have the data returned to us in a JSON-style format, as opposed to XML.&nbsp;</li><li>We should receive the data back to us in less than two seconds.</li><li>Finally, we can test that, yes, the 230 bus line is listed in the system.&nbsp;</li></ul><div>... And all these tests can be run in <b>less than three seconds</b>!&nbsp;</div><div><br /></div><div>For these tests, we will be using as resources:</div><div><ul><li><a href="https://www.oracle.com/java/index.html" target="_blank">Java</a> as the main programming language.&nbsp;</li><li><a href="http://testng.org/doc/" target="_blank">TestNG</a> as the test framework, with its&nbsp;@BeforeClass and @Test&nbsp;annotation to set up pre-conditions for tests and run them. (Want to use JUnit instead? Perfectly fine!)</li><li>The <a href="http://hamcrest.org/JavaHamcrest/" target="_blank">Java Hamcrest</a> library to use the assertThat keyword. I just think it is more readable. You could use regular assertTrue or assertEqual if you really wanted to.&nbsp;</li><li>The Java Utility called TimeUnit to keep track of milliseconds the test runs (see JavaWorld's <a href="http://www.javaworld.com/article/2074114/core-java/the-highly-useful-java-timeunit-enum.html" target="_blank">The Highly Useful Java TimeUnit Enum</a>).&nbsp;</li><li><a href="http://rest-assured.io/" target="_blank">REST Assured</a> to handle interacting with sending and receiving information from the RESTful endpoint.</li></ul>Feel free to steal and modify this code! I did! When I was playing around with the code in Bas' REST Assured Workshop, I had quite a difficult time trying to modify it to fit the MBTA's API. Thank you so much for the help, Baz!&nbsp;</div><div><br /></div><div>The following tests will kick the tires of the API itself, to see if everything is in good working order.&nbsp;</div><div><br /></div><div><b><u>Validate that, if selected, data will be formatted to JSON:</u></b></div><pre style="background: #f0f0f0; border: 1px dashed #cccccc; color: black; font-family: &quot;arial&quot;; font-size: 12px; height: auto; line-height: 20px; overflow: auto; padding: 0px; text-align: left; width: 99%;"><code style="color: black; word-wrap: normal;"> import static io.restassured.RestAssured.*;  <br /> import io.restassured.RestAssured;  <br /> import static org.hamcrest.Matchers.*;  <br /> import org.testng.annotations.BeforeClass;  <br /> import org.testng.annotations.Test;  <br /> import java.util.concurrent.TimeUnit;  <br /> /**   <br />  * Based on https://github.com/basdijkstra/workshops/blob/master/rest-assured/RestAssuredWorkshop  <br />  *  <br />  * Need to connect to the MBTA API manually?  <br />  * http://realtime.mbta.com/developer/api/v2/routes?api_key=wX9NwuHnZU2ToO7GmGR9uw&amp;format=json  <br />  */  <br /> public class MbtaRoutesTest {  <br />   @BeforeClass  <br />   public static void initPath() {  <br />     RestAssured.baseURI = "http://realtime.mbta.com/developer/api/v2/";  <br />   }  <br />   @Test  <br />   public void checkResponseContentTypeIsJson() {  <br />     given().  <br />         param("api_key","wX9NwuHnZU2ToO7GmGR9uw").  <br />         param("format","json").  <br />     when().get("routes").  <br />     then().assertThat().contentType("application/json");  <br />   }  <br /></code></pre><b><u><br /></u></b><b><u>Validate that, if given the correct API key, the HTTP Status Code will be OK: 200</u></b><br /><pre style="background: #f0f0f0; border: 1px dashed #cccccc; color: black; font-family: &quot;arial&quot;; font-size: 12px; height: auto; line-height: 20px; overflow: auto; padding: 0px; text-align: left; width: 99%;"><code style="color: black; word-wrap: normal;">   @Test  <br />   public void checkResponseCodeIsOk200() {  <br />     given().  <br />         param("api_key","wX9NwuHnZU2ToO7GmGR9uw").  <br />         param("format","json").  <br />     when().get("routes").  <br />     then().assertThat().statusCode(200);  <br />   }  <br /></code></pre><br /><b><u>Validate that, if not entering the correct API Key, the user cannot see data:</u></b><br /><pre style="background: #f0f0f0; border: 1px dashed #cccccc; color: black; font-family: &quot;arial&quot;; font-size: 12px; height: auto; line-height: 20px; overflow: auto; padding: 0px; text-align: left; width: 99%;"><code style="color: black; word-wrap: normal;">   @Test  <br />   public void checkUserCannotAccessApiWithoutKey() {  <br />     given().  <br />         param("api_key","invalid-key").  <br />         param("format","json").  <br />     when().get("routes").  <br />     then().assertThat().statusCode(401);  <br />   }  <br /></code></pre><b><u><br /></u></b><b><u>Validate that it will take less than two seconds for data to be returned:</u></b><br /><pre style="background: #f0f0f0; border: 1px dashed #cccccc; color: black; font-family: &quot;arial&quot;; font-size: 12px; height: auto; line-height: 20px; overflow: auto; padding: 0px; text-align: left; width: 99%;"><code style="color: black; word-wrap: normal;">   @Test  <br />   public void checkResponseTimeIsLessThan2seconds() {  <br />     given().  <br />         param("api_key","wX9NwuHnZU2ToO7GmGR9uw").  <br />         param("format","json").  <br />     when().get("routes").  <br />     then().assertThat().time(lessThan(2000L), TimeUnit.MILLISECONDS);  <br />   }  <br /></code></pre><br />Next, we can check that, yes, the 230 Bus Route is still listed.<br /><br />If we manually go to the URL and have the data processed, it will look like:<br /><pre style="background: #f0f0f0; border: 1px dashed #cccccc; color: black; font-family: &quot;arial&quot;; font-size: 12px; height: auto; line-height: 20px; overflow: auto; padding: 0px; text-align: left; width: 99%;"><code style="color: black; word-wrap: normal;"> {  <br />  "mode": [  <br />   {  <br />    "route_type": "0",  <br />    "mode_name": "Subway",  <br />    "route": [  <br />     {  <br />      ...  <br />     }  <br />    ]  <br />   },  <br />   {  <br />    "route_type": "1",  <br />    "mode_name": "Subway",  <br />    "route": [  <br />     {  <br />      "route_id": "Red",  <br />      "route_name": "Red Line"  <br />     .....  <br />     }  <br />    ]  <br />   },  <br />   {  <br />    "route_type": "2",  <br />    "mode_name": "Commuter Rail",  <br />    "route": [  <br />     {  <br />      ....  <br />     }  <br />    ]  <br />   },  <br />   {  <br />    "route_type": "3",  <br />    "mode_name": "Bus",  <br />    "route": [  <br />     {  <br />      ....  <br />     },  <br />     {  <br />      "route_id": "230",  <br />      "route_name": "230"  <br />     },  <br />    ]  <br />   },  <br />   {  <br />    "route_type": "4",  <br />    "mode_name": "Boat",  <br />    "route": [  <br />     {  <br />      "route_id": "Boat-F4",  <br />      "route_name": "Charlestown Ferry"  <br />     }<br />    ]  <br />   }  <br />  ]  <br /> }  <br /></code></pre><br /><b><u><br /></u></b><b><u>Validate that the 230 Bus Route Is Listed:</u></b><br /><pre style="background: #f0f0f0; border: 1px dashed #cccccc; color: black; font-family: &quot;arial&quot;; font-size: 12px; height: auto; line-height: 20px; overflow: auto; padding: 0px; text-align: left; width: 99%;"><code style="color: black; word-wrap: normal;">   @Test  <br />   public void checkThatRoute230isListed() {  <br />     given().  <br />         param("api_key","wX9NwuHnZU2ToO7GmGR9uw").  <br />         param("format","json").  <br />     when().get("routes").  <br />     then().assertThat().  <br />         statusCode(200).  <br />         body("mode.mode_name", hasItems("Bus"),  <br />             "mode[3].route.route_name", hasItem("230"));;  <br />   }  <br /></code></pre><br />If we run all the tests at the same time, we can see that:<br /><div class="separator" style="clear: both; text-align: center;"><a href="https://3.bp.blogspot.com/-P_SG1QBfmrE/WNWuEwVKl3I/AAAAAAAALro/lyCsLNJ6ls0BGAOHCeA9etR1iSVLgE54ACLcB/s1600/Screen%2BShot%2B2017-03-24%2Bat%2B7.36.18%2BPM.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="156" src="https://3.bp.blogspot.com/-P_SG1QBfmrE/WNWuEwVKl3I/AAAAAAAALro/lyCsLNJ6ls0BGAOHCeA9etR1iSVLgE54ACLcB/s640/Screen%2BShot%2B2017-03-24%2Bat%2B7.36.18%2BPM.png" width="640" /></a></div><br /><ul><li>All five tests passed!</li><li>It took less than three seconds for all the tests to run.</li><li>Yes, Bus #230 is listed!</li></ul><br /><br />Once again, thank you very much, Bas, for your help with this!<br /><br />Happy Testing! <br /><br /><div class="toc-section" id="toc-section"><b>Are you sure the bus line is still listed?</b><br /><ul><li><b>Part One:</b>&nbsp;<a href="http://www.tjmaher.com/2017/02/are-you-sure-bus-line-still-listed.html">Don't gather data from the UI. Use a RESTful API endpoint instead!</a></li><li><b>Part Two:</b>&nbsp;<a href="http://www.tjmaher.com/2017/03/are-you-sure-bus-line-is-still-listed.html">Interacting with the MBTA's API using REST Assured</a></li><li><b>Source Code:</b>&nbsp;<a href="https://github.com/tjmaher/RestAssuredJavaDemo/blob/master/src/test/java/MbtaRoutesTest.java">GitHub, T.J. Maher</a></li></ul></div><br />-T.J. Maher<br /><a href="https://twitter.com/tjmaher1" style="color: #1155cc;" target="_blank">Twitter</a>&nbsp;|&nbsp;<a href="https://www.linkedin.com/in/tjmaher1" style="color: #1155cc;" target="_blank">LinkedIn</a>&nbsp;|&nbsp;<a href="https://github.com/tjmaher" style="color: #1155cc;" target="_blank">GitHub</a><br /><br /><i>// Sr. QA Engineer, Software Engineer in Test, Software Tester since 1996.<br />// Contributing Writer for&nbsp;<a href="http://techbeacon.com/contributors/thomas-maher" style="color: #1155cc;" target="_blank">TechBeacon.</a><br />// "Looking to move away from manual QA?&nbsp;Follow&nbsp;<a href="http://www.tjmaher.com/" style="color: #1155cc;" target="_blank">Adventures in Automation</a>&nbsp;on <a href="https://www.facebook.com/AdventuresInAutomation/" target="_blank">Facebook</a>!"</i></div><br />