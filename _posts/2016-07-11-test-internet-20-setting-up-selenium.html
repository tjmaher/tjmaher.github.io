---
layout: post
title: 'Test The-Internet 2.0: Setting up Selenium Grid: RemoteDriver and DesiredCapabilities'
date: '2016-07-11T07:00:00.000-04:00'
author: T.J. Maher
tags:
- SeleniumGrid
- Docker
- test framework
- RemoteWebDriver
modified_time: '2016-07-11T07:27:42.773-04:00'
thumbnail: https://1.bp.blogspot.com/-td245UgFxwk/V4Jbsmmjp4I/AAAAAAAALTU/f-gNFo25_YEWrnafKSMl-6ksXb8Pe-nHgCLcB/s72-c/grid.png
blogger_id: tag:blogger.com,1999:blog-3868566217808655382.post-8453950270468581734
blogger_orig_url: http://www.tjmaher.com/2016/07/test-internet-20-setting-up-selenium.html
---

<b>Recap</b>: Since May 2016, we've been blogging about forming a new&nbsp;<b>automated test framework</b> using Dave Haeffner's test site, <a href="http://the-internet.herokuapp.com/login" target="_blank">The-Internet</a>.<br /><br />Picking <b>Gradle</b> as the build tool, we walked through how to create unit tests,&nbsp;just to make sure everything is still working as we make changes to the project, setting them up in&nbsp;<b>JUnit</b>&nbsp;and&nbsp;<b>Hamcrest</b>&nbsp;in both&nbsp;<a href="http://www.tjmaher.com/2016/05/webdriver-development-environment-setup.html" target="_blank">IntelliJ</a>&nbsp;and&nbsp;<a href="http://www.tjmaher.com/2016/06/webdriver-development-environment-setup.html" target="_blank">Eclipse</a>.<br /><br />Like the two frameworks we <a href="http://www.tjmaher.com/p/programming-projects.html" target="_blank">built last year</a>, we are using <a href="http://www.tjmaher.com/2015/04/how-selenium-webdriver-uses-css.html" target="_blank">CSS Selectors</a> to find the web elements on a page. We grouped together pages using the&nbsp;<a href="http://www.tjmaher.com/2016/06/page-factories-setting-up-creating-them.html" target="_blank">Page Object Model and PageFactories</a>. After walking through the reader with experimenting with first <a href="http://www.tjmaher.com/2016/07/setup-of-selenium-grid-for-beginners.html" target="_blank">Selenium Grid</a> and then <a href="http://www.tjmaher.com/2016/07/setting-up-docker-easy-way-on-mac-or.html" target="_blank">Docker</a>, we set up Selenium Grid using official Docker <a href="http://www.tjmaher.com/2016/07/setting-up-selenium-grid-with-chrome.html" target="_blank">images from Docker</a> Hub.<br /><br />... I should call this blog post, "How I spent my summer vacation". Each time we rewrite our test framework, I experiment on this blog with tools and technologies we are using at work. Instead of spending four hours reading a technical manual, I'm spending the same amount of time getting my hands dirty, taking notes all along the way. It takes no time at all to turn all that research I collected into a blog post.<br /><br />With this blog post, we will be using&nbsp;<b>RemoteWebDriver</b> to bring in the browser nodes listed in our <b>Selenium Grid</b>, connecting them with <b>DesiredCapabilities</b> to help run our tests.<br /><br /><a name='more'></a><br /><br /><h2>Why Use RemoteWebDriver?</h2><br />Why use RemoteWebDriver over having each automated tester set up Selenium Grid up on each local machine?<br /><br />It's not just because of Selenium Grid standardization: If your automated test framework uses RemoteWebDriver, you can then hook up your tests to&nbsp;<a href="https://saucelabs.com/" target="_blank">SauceLabs</a>&nbsp;or&nbsp;<a href="https://www.browserstack.com/" target="_blank">Browserstack</a>'s Selenium Grid configuration, or even an internal company-wide Docker / Selenium Grid.<br /><br /><h2>Run Selenium Grid</h2><br />Feel free to check my notes on how to setup <a href="http://www.tjmaher.com/2016/07/setting-up-docker-easy-way-on-mac-or.html" target="_blank">Docker Toolbox</a> and <a href="http://www.tjmaher.com/2016/07/setting-up-selenium-grid-with-chrome.html" target="_blank">run Docker-Selenium</a>&nbsp;if you want to run Selenium Grid from a Docker image. We are using SeleniumHQ's Docker-Selenium site at&nbsp;<a href="https://github.com/SeleniumHQ/docker-selenium">https://github.com/SeleniumHQ/docker-selenium</a> and SeleniumHQ's Docker images on the Docker Hub at&nbsp;<a href="https://hub.docker.com/u/selenium/">https://hub.docker.com/u/selenium/</a>.<br /><br />There are mainly two ways to set up browsers with your automated test framework: <b>Headless</b> and <b>within an actual browser</b>.<br /><br /><ul><li><b><u>Headless</u></b>: If you are diagnosing failures, watching WebDriver enter data into the browser in real time is very helpful. For every other time, when you just want to see what passed and what failed, you can run the tests in a <i>headless</i> fashion, i.e. without spinning up a browser. We are going to be setting up <i><a href="https://hub.docker.com/r/selenium/node-chrome/" target="_blank">selenium/node-chrome</a></i> and <i><a href="https://hub.docker.com/r/selenium/node-firefox/" target="_blank">selenium/node-firefox</a></i> in this fashion.&nbsp;</li><li><b><u>Locally, in a browser</u></b>: Running the test using the browsers already installed on your system is the easiest way to debug a test. Yes, we can see what is happening by using <i><a href="https://hub.docker.com/r/selenium/node-chrome-debug/" target="_blank">selenium/node-chrome-debug</a></i>&nbsp;and&nbsp;<i><a href="https://hub.docker.com/r/selenium/node-firefox-debug/" target="_blank">selenium/node-firefox-debug</a></i> coupled with a&nbsp;&nbsp;<b>VNC Viewer</b>&nbsp;(Virtual Network Computer) such as <a href="https://www.realvnc.com/" target="_blank">Real VNC</a> to spy on what is happening in the browser. Or you can use the standalone Docker images of Chrome and Firefox. But locally is easier.&nbsp;</li></ul><br />Right now, we are going to be running our tests Headlessly, as they would be set up in a Continuous Integration or Continuous Development environment with Jenkins. Later, we will add running browsers locally, and adding logging functionality, but I would rather that those topics get their own blog entry.<br /><br />Setup for a Selenium Grid on your local environment is quicker:<br /><ul><li>View the official SeleniumHQ instructions <a href="http://www.seleniumhq.org/docs/07_selenium_grid.jsp" target="_blank">here</a>.</li><li>Read my <a href="http://www.tjmaher.com/2016/07/setup-of-selenium-grid-for-beginners.html" target="_blank">walkthrough of setting up Selenium Grid</a> on your local environment.</li></ul><br />... You can still connect that Selenium Grid setup to your automated tests. You would just need to substitute your IP address and port number with the one I get from using the Docker Terminal.<br /><h3><br />How to Run an Existing Docker-Selenium Setup:</h3><br /><b>Step 1: Blow away Old Docker-Selenium Containers</b><br /><br />It's best to start off with a fresh instance of Docker Selenium. Check for old instances of Docker-Selenium<br /><ul><li>Start up Docker QuickStart Terminal from the&nbsp;<a href="http://www.tjmaher.com/2016/07/setting-up-docker-easy-way-on-mac-or.html" target="_blank">Docker Toolbox</a>&nbsp;installation</li><li>Check what containers are running:&nbsp;<i>docker ps -a</i></li><li>Stop all container from running:&nbsp;<i>docker stop $(docker ps -a -q)</i></li><li>Remove all containers:&nbsp;<i>docker rm $(docker ps -a -q)</i></li></ul><b><br /></b><b>Step 2: Startup &nbsp;Docker-Selenium:</b><br /><ul><li>Start up the Selenium Grid Hub and Nodes from the Docker Terminal:</li></ul><pre style="background: #f0f0f0; border: 1px dashed #cccccc; color: black; font-family: &quot;arial&quot;; font-size: 12px; height: auto; line-height: 20px; overflow: auto; padding: 0px; text-align: left; width: 99%;"><code style="color: black; word-wrap: normal;"> docker run -d -p 4444:4444 --name selenium-hub selenium/hub:2.53.0  <br /> docker run -d --link selenium-hub:hub selenium/node-chrome:2.53.0   <br /> docker run -d --link selenium-hub:hub selenium/node-firefox:2.53.0   <br /></code></pre><br /><b>Step 3: Verify that Selenium Grid is Running</b><br /><br />My Selenium Grid is set up to&nbsp;<a href="http://192.168.99.100:4444/wd/">http://192.168.99.100:4444/wd/</a>. Go to the IP address and Port where you set up your Grid.<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="https://1.bp.blogspot.com/-td245UgFxwk/V4Jbsmmjp4I/AAAAAAAALTU/f-gNFo25_YEWrnafKSMl-6ksXb8Pe-nHgCLcB/s1600/grid.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="126" src="https://1.bp.blogspot.com/-td245UgFxwk/V4Jbsmmjp4I/AAAAAAAALTU/f-gNFo25_YEWrnafKSMl-6ksXb8Pe-nHgCLcB/s400/grid.png" width="400" /></a></div><br />Ladies and Gentlemen, we have a Selenium Grid!<br /><h2><br />Run a Headless Firefox Test&nbsp;</h2>We set up in the&nbsp;<a href="http://www.tjmaher.com/2016/07/setting-up-selenium-grid-with-chrome.html" target="_blank">last&nbsp;Test The-Internet 2.0</a>&nbsp;post a quick and dirty test that used <b>RemoteWebDriver</b> and <b>DesiredCapabilities</b> to run a browser node off our Selenium Grid.<br /><br />Sample Code:<br /><pre class="brush: java">import org.junit.Test;<br />import org.openqa.selenium.Platform;<br />import org.openqa.selenium.remote.DesiredCapabilities;<br />import org.openqa.selenium.remote.RemoteWebDriver;<br /><br />import java.net.URL;<br /><br />import static org.hamcrest.CoreMatchers.is;<br />import static org.hamcrest.MatcherAssert.assertThat;<br />import static org.hamcrest.core.IsEqual.equalTo;<br /><br />@Test<br />public void test_FirefoxDockerGridNavigatesToLoginPage() throws Exception  {<br />   DesiredCapabilities capabilities = DesiredCapabilities.firefox();<br />   capabilities.setBrowserName("firefox");<br />   capabilities.setPlatform(Platform.LINUX);<br />   driver = new RemoteWebDriver(new <br />           URL("<a href="http://192.168.99.100:4444/wd/hub" target="_blank">http://192.168.99.100:4444/wd/hub</a>"), capabilities);<br />   driver.get("<a href="http://the-internet.herokuapp.com/login" target="_blank">http://the-internet.herokuapp.com/login</a>");<br />   assertThat(driver.getTitle(), is(equalTo("The Internet")));<br />}<br /></pre><div><br /></div>Remember, with our setup right now, our test is using a Headless Browser. We are just focusing on adding RemoteWebDriver functionality with DesiredCapabilities in this blog entry, so we are only concerned at the moment if the test passes or fails.<br /><br />We'll add running tests locally, and adding logging functionality with a later blog post talking about diagnosing failures. For now, let's run the test in IntelliJ (or whatever your favorite IDE is), and check to see if the test passed:<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="https://2.bp.blogspot.com/-BkUJpazxvsQ/V4KiO-dXmYI/AAAAAAAALTs/F7rpzPytSksPw1M_Anhd2S_hbWLpwBzJACLcB/s1600/test%2Bruns.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="77" src="https://2.bp.blogspot.com/-BkUJpazxvsQ/V4KiO-dXmYI/AAAAAAAALTs/F7rpzPytSksPw1M_Anhd2S_hbWLpwBzJACLcB/s400/test%2Bruns.png" width="400" /></a></div><br />Success! The test passed! Firefox ran the test, opened up Dave Haeffner's <a href="http://the-internet.herokuapp.com/login" target="_blank">Login Page</a> on his site, The-Internet, and asserted that yes, the title was "The Internet".<br /><br />There is a problem, though...<br /><br />What is RemoteWebDriver, anyway? And what is DesiredCapabilities?<br /><br />Right now, we are using Firefox / Linux and Chrome / Linux as browser nodes. Are we going to cut-and-paste the same code to set up DesiredCapabilites each and every time?<br /><br />And should this test be in LoginPageTest? What if we want to expand the test to be more robust, and you know, actually check to see if logging in actually passes or fails?<br /><br />Let's go over what RemoteWebDriver is first. For the other concerns we have, let's handle that in the Refactoring section.<br /><h2><br />What Is RemoteWebDriver?</h2><br />RemoteWebDriver is the Java class that the SeleniumHQ people designed to join their webserver with the automated tests. You can see the source code of RemoteWebDriver on their GitHub site at&nbsp;<a href="https://github.com/SeleniumHQ/selenium/blob/master/java/client/src/org/openqa/selenium/remote/RemoteWebDriver.java" target="_blank">openqa/selenium/remote/RemoteWebDriver.java</a>.<br /><br />With our test, we started a new WebDriver instance, and assigned it a new <b>RemoteWebDriver</b> with the following line of code:<br /><ul><li>new RemoteWebDriver(new URL("http://192.168.99.100:4444/wd/hub"), capabilities);</li></ul><div>That URL needs to match wherever your Selenium Grid is located, from IP address, to port, to the correct directory.&nbsp;</div><div><br /></div><div>If you are running&nbsp;<a href="https://saucelabs.com/" target="_blank">SauceLabs</a> or <a href="https://www.browserstack.com/" target="_blank">Browserstack</a>'s Selenium Grid configuration, or an internal Docker / Selenium Grid your entire company uses, the URL needs to match.&nbsp;</div><div><br /></div>We then set up <b>DesiredCapabilities</b>:<br /><ul><li>Instantiate a new DesiredCapabilities object</li><li>Declare it to be of method <i>firefox</i></li><li>Set the browser name to be "firefox"</li><li>Set the platform to be Linux.</li><li>Make the DesiredCapabilities match exactly what we have running in our Selenium Grid.</li></ul>... Note, the name of the method is "desired" capabilities. A browser node spun up by RemoteWebDriver may or may not have all those properties. If you are attempting to use Firefox on a Mac or Windows platform, and there isn't a browser node that is running on that virtual (or real) platform, the Selenium Grid is going to run the next best thing.<br /><br />You can also pass in a list of <i>RequiredCapabilities</i> along with the DesiredCapabilities, but in my past few jobs I just haven't seen this used.<br /><br />When you instantiate a RemoteWebDriver, that URL pointing to Selenium Grid becomes the Command Executor. It then tries to:<br /><ul><li>Start a new client on the Selenium Grid server.</li><li>Start a new session on the Selenium Grid server.&nbsp;</li></ul>With RemoteWebDriver you can use the following properties:<br /><ul><li>Get and set a session id.</li><li>Get the W3C Standard Compliance level (an integer value).</li><li>Get the title, the current url, findElements by id, classname, cssSelector, XPath, by name, all the things you can do with a regular WebDriver.</li><li>Like WebDriver, you can also select by windowHandle, useful if there is a popup alert or multiple browser windows you need to <i>switchTo()</i>.&nbsp;</li><li>Get the Screenshots taken as Base64 Encoded PNG or other formats by executing a DriverCommand.SCREENSHOT.</li><li>You can see if the browser you are using <i>isJavascriptEnabled()</i>.</li><li>You can setLogLevel by Level.&nbsp;</li><li>Hrm... tagged as&nbsp;@Beta, there is a method called <i>setCredentials</i>, where you are passing in a Credentials object (<span style="background-color: white; color: #333333; font-family: &quot;consolas&quot; , &quot;liberation mono&quot; , &quot;menlo&quot; , &quot;courier&quot; , monospace; font-size: 12px; line-height: 16.8px; white-space: pre;"><i>org.openqa.selenium.security.Credentials</i>)</span>. I need to look into that...&nbsp;</li></ul><br />After a test has finished you can:<br /><ul><li>Delete a cookie by name: deleteCookie(Cookie cookie)</li><li>Delete all cookies: deleteAllCookies();</li><li>Close the session: Note this just executes to the driver DriverCommand.Close: driver.close();</li><li>Quit the session: This closes the session as above, makes the sessionID to be&nbsp;<i>null</i>, then stops the client. It's much more graceful.&nbsp;</li></ul><h2>What is DesiredCapabilities?</h2>There are two types of DesiredCapabilities: &nbsp;Ones for all browsers, and ones that are browser-specific, such as for Chrome or Firefox.<br /><br />You can set:<br /><ul><li>DesiredCapability: Sets the brower node you are hoping to find: android, iPad, iPhone, internetExplorer, firefox, chrome, edge (Microsoft Edge), operaBlink ( <a href="https://en.wikipedia.org/wiki/Blink_(web_engine)" target="_blank">Blink</a> is a Chromium based web browser engine that can be used in the Opera browser), phantomJS (a headless browser). &nbsp;</li><li>BrowserName, Platform, Version (such as IE 9, IE 10, IE 11.</li><li>isJavaEnabled()</li></ul><div>Are you going to be using SauceLabs?</div><div><br /></div><div><b>SauceLabs</b> has a new <b>Platform Configurator</b> on the Sauce Labs Wiki at&nbsp;<a href="https://wiki.saucelabs.com/display/DOCS/Platform+Configurator#/">https://wiki.saucelabs.com/display/DOCS/Platform+Configurator#/</a><br /><br />Let's say we want to use Sauce Labs instead of our own Selenium Grid, we can use their Platform Configurator to chose to set up for WebDriver the Microsoft Edge on a Windows 10 platform with a screen resolution of 1024 x 768... and let's pick a version of the Edge browser, too. If we leave it blank, it will automatically search for the latest version. &nbsp;</div><br /><pre style="background: #f0f0f0; border: 1px dashed #cccccc; color: black; font-family: &quot;arial&quot;; font-size: 12px; height: auto; line-height: 20px; overflow: auto; padding: 0px; text-align: left; width: 99%;"><code style="color: black; word-wrap: normal;"> DesiredCapabilities caps = DesiredCapabilities.edge();  <br /> caps.setCapability("platform", "Windows 10");  <br /> caps.setCapability("version", "13.10586");  <br /> caps.setCapability("screenResolution", "1024x768");  <br /></code></pre><br />You can learn more about how their Selenium Test Configurations at&nbsp;<a href="https://wiki.saucelabs.com/display/DOCS/Test+Configuration+Options">https://wiki.saucelabs.com/display/DOCS/Test+Configuration+Options</a><br /><h2><br />Refactor RemoteWebDriver into a Driver Utilities Class&nbsp;</h2>Let's take a look at that browser test we have,&nbsp;<i>test_FirefoxDockerGridNavigatesToLoginPage()</i>. What if other tests want to use RemoteWebDriver? We shouldn't copy-and-paste that code into each and every test. Let's put that in its own Java class... call it DriverUtils.<br /><br />While we are at it, let's move the test to an actual Test class, since we are going to do more than just stay on the Login page... we are going to eventually want to make sure that we end up on the landing page, SecureArea.<br /><br /><pre class="brush: java">public class TestCases {<br />private static WebDriver driver;<br /><br />@BeforeClass<br />public static void setUp() throws Exception {<br /><br />}<br /><br />@Test<br />public void test_FirefoxDockerGridNavigatesToLoginPage() throws Exception  {<br />   driver = DriverUtils.getGridDriver("firefox");<br />   LoginPage login = new LoginPage(driver);<br />   login.navigateToLoginPage(driver);<br />   assertThat(driver.getTitle(), is(equalTo("The Internet")));<br />}<br />@Test<br />public void test_ChromeDockerGridNavigatesToLoginPage() throws Exception  {<br />   driver = DriverUtils.getGridDriver("chrome");<br />   LoginPage login = new LoginPage(driver);<br />   login.navigateToLoginPage(driver);<br />   assertThat(driver.getTitle(), is(equalTo("The Internet")));<br />}<br />@AfterClass<br />public static void tearDown(){<br />   driver.quit();<br />}<br />}<br /></pre><br />To make the test code display better on the page, I moved everything over five spaces to the left.<br /><br />We created a new utility class that I dubbed, "DriverUtils.java". In it is a method I called getGridDriver. Pass in the String "chrome" or "firefox", and the RemoteWebDriver and DesiredCapabilities for the browser in the grid is set up.<br /><br /><pre class="brush: java">public class DriverUtils {<br /><br />public static RemoteWebDriver driver = null;<br /><br />public static RemoteWebDriver getGridDriver(String browser) {<br />   System.out.println("Selenium Grid: Starting");<br />   DesiredCapabilities capabilities = getCapabilities(browser);<br />   try {<br />       driver = new RemoteWebDriver(<br />               new URL("http://192.168.99.100:4444/wd/hub"),<br />               capabilities);<br />   } catch (MalformedURLException e) {<br />       System.out.println("Selenium Grid: ERROR!\n" + e);<br />       e.printStackTrace();<br />    }<br />   return driver;<br />}<br /><br />private static DesiredCapabilities getCapabilities(String browser){<br />   System.out.println("Browser: " + browser);<br />   DesiredCapabilities capabilities = DesiredCapabilities.firefox();<br />   if (browser.equals("firefox")) {<br />       capabilities = DesiredCapabilities.firefox();<br />   } else if (browser.equals("chrome")) {<br />       capabilities = DesiredCapabilities.chrome();<br />   } else {<br />       System.out.println("Browser not found: " + browser);<br />       System.out.println("Selecting: Firefox");<br />   }<br />   capabilities.setCapability("platform", Platform.LINUX);<br />   return capabilities;<br />}<br />}<br /></pre><br />The framework isn't perfect. We still haven't added:<br /><br /><ul><li>Multithreading, so we can run tests in parallel.&nbsp;</li><li>Logging, such as with Log4J, telling what the test is doing.&nbsp;</li><li>We can't run the test locally if we so chose. It would be nice to be able to have different configurations in IntelliJ where we could choose to run locally or through Selenium Grid.&nbsp;</li></ul><div>... Each bullet point will be a future blog entry. &nbsp;</div><div><br /></div><div>More importantly the tests need a lot of work:</div><div><ul><li>Sure the runs, but it doesn't do anything besides go to the Login Page! We need to add more to the test.&nbsp;</li><li>The Firefox test and the Chrome test looks awfully similar. Maybe we can refactor the code, placing common elements of a test in its own private method?&nbsp;</li></ul></div><br />That part will happen in the next "Test The-Internet 2.0" themed blog post.<br /><br />Until then, Happy Testing! <br /><br />-T.J. Maher<br />Sr. QA Engineer, <br />Fitbit-Boston<br /><br /><i>// BSCS, MSE, and QA Engineer since Aug. 1996 <br />// Automation developer for [ 1.5 ] years and still counting!<br />// Check out Adventures in Automation and Like us on <a href="https://www.facebook.com/AdventuresInAutomation/">Facebook</a>! </i>