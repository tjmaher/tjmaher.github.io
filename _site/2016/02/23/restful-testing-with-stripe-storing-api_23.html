<i>This post is third in a series of six. Need to go <a href="/2016/02/coming-up-how-to-work-with-rest-apis.html">back to the beginning</a>?</i><br /><br />So far we covered why we should incorporate tests other than UI tests into our automation test suite. We gave a brief background on RESTful APIs. And we showed how to interact with the Stripe API through GET methods with HTTPS and POST methods with cURL. <br /><br />Now, we can start writing code to interact with Stripe! We are going to:<br /><ul><li>Store the Stripe API Key in a properties file, pretending that the general purpose key is actually two different keys: One for the US and one for Canada.</li><li>Write a method to Load the Properties</li><li>Create a basic Stripe Utilities that forces the user to select which country we are using. Using that information the proper API key is loaded.&nbsp;</li><li>Start writing a test class containing tests that confirm Stripe Utilities can only be instantiated if and only if the country is either US or Canada.&nbsp;</li></ul><h3></h3><h3 style="font-size: medium; font-weight: normal;"><b>What Our Framework Will Look Like</b></h3><div style="font-size: medium; font-weight: normal;"><b></b><br /><a name='more'></a><b><br /></b></div><div style="font-size: medium; font-weight: normal;">By the end of this blog post, our automated test framework will look something like this:</div><div style="font-size: medium; font-weight: normal;"><br /></div><div style="font-size: medium; font-weight: normal;"><b>src/test/java</b></div><ul style="font-size: medium; font-weight: normal;"><li>data</li><ul><li>LoadProperties.java</li></ul><li>libraries</li><ul><li>StripeUtils.java</li></ul><li>properties</li><ul><li>qa-properties.properties</li></ul><li>testcases</li><ul><li>Stripe.java</li></ul></ul><h3></h3>First, let's talk about storing the keys in properties files.<br /><h3><br />What is a .properties file?</h3><div>We are going to store the Stripe API Key for the general public in a properties file... But what is a properties file?<br /><br />A Properties file is just a plain ole text file with the extension ".properties" after it.</div><blockquote class="tr_bq">".properties is a file extension for files mainly used in Java related technologies to store the configurable parameters of an application. They can also be used for storing strings for Internationalization and localization; these are known as Property Resource Bundles.<br /><br />"Each parameter is stored as a pair of strings, one storing the name of the parameter (called the key), and the other storing the value". <i>- Wikipedia, <a href="https://en.wikipedia.org/wiki/.properties" target="_blank">.properties&nbsp;</a></i></blockquote><div style="text-align: center;"><b><span style="font-size: x-large;">. . .</span></b></div><blockquote class="tr_bq">"Properties is a subclass of Hashtable. It is used to maintain lists of values in which the key is a String and the value is also a String.<br /><br />"The Properties class is used by many other Java classes. For example, it is the type of object returned by System.getProperties( ) when obtaining environmental values [...]"<br /><div style="text-align: right;">- <i>TutorialsPoint, <a href="http://www.tutorialspoint.com/java/java_properties_class.htm" target="_blank">Java Properties</a>&nbsp;</i></div></blockquote><br /><h3>How Do We Implement It?</h3><i style="text-align: right;">StackOverflow,&nbsp;<a href="http://stackoverflow.com/questions/333363/loading-a-properties-file-from-java-package" target="_blank">Loading a Properties File From a Java Package</a>:</i><br /><blockquote class="tr_bq">"When loading the Properties from a Class in the package com.al.common.email.templates you can use"</blockquote><pre class="lang-java prettyprint prettyprinted" style="background-color: #eeeeee; border: 0px; color: #393318; font-family: Consolas, Menlo, Monaco, 'Lucida Console', 'Liberation Mono', 'DejaVu Sans Mono', 'Bitstream Vera Sans Mono', 'Courier New', monospace, sans-serif; font-size: 13px; margin-bottom: 1em; max-height: 600px; overflow: auto; padding: 5px; width: auto; word-wrap: normal;"><code style="border: 0px; font-family: Consolas, Menlo, Monaco, 'Lucida Console', 'Liberation Mono', 'DejaVu Sans Mono', 'Bitstream Vera Sans Mono', 'Courier New', monospace, sans-serif; margin: 0px; padding: 0px; white-space: inherit;"><span class="typ" style="border: 0px; color: #2b91af; margin: 0px; padding: 0px;">Properties</span><span class="pln" style="border: 0px; color: black; margin: 0px; padding: 0px;"> prop </span><span class="pun" style="border: 0px; color: black; margin: 0px; padding: 0px;">=</span><span class="pln" style="border: 0px; color: black; margin: 0px; padding: 0px;"> </span><span class="kwd" style="border: 0px; color: darkblue; margin: 0px; padding: 0px;">new</span><span class="pln" style="border: 0px; color: black; margin: 0px; padding: 0px;"> </span><span class="typ" style="border: 0px; color: #2b91af; margin: 0px; padding: 0px;">Properties</span><span class="pun" style="border: 0px; color: black; margin: 0px; padding: 0px;">();</span><span class="pln" style="border: 0px; color: black; margin: 0px; padding: 0px;"><br /></span><span class="typ" style="border: 0px; color: #2b91af; margin: 0px; padding: 0px;">InputStream</span><span class="pln" style="border: 0px; color: black; margin: 0px; padding: 0px;"> in </span><span class="pun" style="border: 0px; color: black; margin: 0px; padding: 0px;">=</span><span class="pln" style="border: 0px; color: black; margin: 0px; padding: 0px;"> getClass</span><span class="pun" style="border: 0px; color: black; margin: 0px; padding: 0px;">().</span><span class="pln" style="border: 0px; color: black; margin: 0px; padding: 0px;">getResourceAsStream</span><span class="pun" style="border: 0px; color: black; margin: 0px; padding: 0px;">(</span><span class="str" style="border: 0px; color: maroon; margin: 0px; padding: 0px;">"foo.properties"</span><span class="pun" style="border: 0px; color: black; margin: 0px; padding: 0px;">);</span><span class="pln" style="border: 0px; color: black; margin: 0px; padding: 0px;"><br />prop</span><span class="pun" style="border: 0px; color: black; margin: 0px; padding: 0px;">.</span><span class="pln" style="border: 0px; color: black; margin: 0px; padding: 0px;">load</span><span class="pun" style="border: 0px; color: black; margin: 0px; padding: 0px;">(</span><span class="pln" style="border: 0px; color: black; margin: 0px; padding: 0px;">in</span><span class="pun" style="border: 0px; color: black; margin: 0px; padding: 0px;">);</span><span class="pln" style="border: 0px; color: black; margin: 0px; padding: 0px;"><br />in</span><span class="pun" style="border: 0px; color: black; margin: 0px; padding: 0px;">.</span><span class="pln" style="border: 0px; color: black; margin: 0px; padding: 0px;">close</span><span class="pun" style="border: 0px; color: black; margin: 0px; padding: 0px;">();</span></code></pre><blockquote class="tr_bq">"(Add all the necessary exception handling).</blockquote><blockquote class="tr_bq">"If your class is not in that package, you need to aquire the InputStream slightly differently:</blockquote><pre 75="" class="lang-java prettyprint prettyprinted" normal="" style="background-color: #eeeeee; border: 0px; color: #393318; font-family: Consolas, Menlo, Monaco, 'Lucida Console', 'Liberation Mono', 'DejaVu Sans Mono', 'Bitstream Vera Sans Mono', 'Courier New', monospace, sans-serif; font-size: 13px; margin-bottom: 1em; max-height: 600px; overflow: auto; padding: 5px;" word-wrap:=""><code style="border: 0px; font-family: Consolas, Menlo, Monaco, 'Lucida Console', 'Liberation Mono', 'DejaVu Sans Mono', 'Bitstream Vera Sans Mono', 'Courier New', monospace, sans-serif; margin: 0px; padding: 0px; white-space: inherit;"><span class="typ" style="border: 0px; color: #2b91af; margin: 0px; padding: 0px;">InputStream</span><span class="pln" style="border: 0px; color: black; margin: 0px; padding: 0px;"> in </span><span class="pun" style="border: 0px; color: black; margin: 0px; padding: 0px;">=</span><span class="pln" style="border: 0px; color: black; margin: 0px; padding: 0px;"> <br /> getClass</span><span class="pun" style="border: 0px; color: black; margin: 0px; padding: 0px;">().</span><span class="pln" style="border: 0px; color: black; margin: 0px; padding: 0px;">getResourceAsStream</span><span class="pun" style="border: 0px; color: black; margin: 0px; padding: 0px;">(</span><span class="str" style="border: 0px; color: maroon; margin: 0px; padding: 0px;">"/com/al/common/email/templates/foo.properties"</span><span class="pun" style="border: 0px; color: black; margin: 0px; padding: 0px;">);</span></code></pre><blockquote class="tr_bq">"Relative paths (those without a leading '/') in getResource()/getResourceAsStream() mean that the resource will be searched relative to the directory which represents the package the class is in.<br /><br />"Using java.lang.String.class.getResource("foo.txt") would search for the (inexistent) file /java/lang/String/foo.txt on the classpath.<br /><br />"Using an absolute path (one that starts with '/') means that the current package is ignored".</blockquote><br /><div style="text-align: right;"><i>-&nbsp;</i></div><br /><h3>Store the Stripe API Key</h3><br />We can see in the <b>Stripe API documentation</b> at <a href="https://stripe.com/docs/api#intro">https://stripe.com/docs/api#intro</a> that in the cURL statement used to hit their endpoint...<br /><br /><pre class=" hljs language-bash" style="background: rgb(39, 43, 45); border-radius: 5px; border: 0px; color: #d0d0d0; direction: ltr; font-family: 'Source Code Pro', Menlo, monospace; font-size: 13px; line-height: 1.5em; outline: 0px; padding: 20px 40px; tab-size: 4; vertical-align: baseline; white-space: pre-wrap; word-break: normal;"><code class=" language-bash" style="border: 0px; direction: ltr; font-family: inherit; font-style: inherit; font-weight: inherit; margin: 0px; outline: 0px; padding: 0px; tab-size: 4; vertical-align: baseline; word-break: normal; word-spacing: normal;"><span class="token request-url" style="border: 0px; color: #c1ef65; font-family: inherit; font-style: inherit; font-weight: inherit; margin: 0px; outline: 0px; padding: 0px; vertical-align: baseline;"><span class="token keyword" style="border: 0px; color: #ebde68; font-family: inherit; font-style: inherit; font-weight: inherit; margin: 0px; outline: 0px; padding: 0px; vertical-align: baseline;">curl</span> https://api.stripe.com/v1/charges <span class="token operator" style="border: 0px; color: #f099a6; font-family: inherit; font-style: inherit; font-weight: inherit; margin: 0px; outline: 0px; padding: 0px; vertical-align: baseline;">\</span></span>&nbsp;</code><span class="token api-key" style="border: 0px; color: #c1ef65; font-family: inherit; font-style: inherit; font-weight: inherit; line-height: 1.5em; margin: 0px; outline: 0px; padding: 0px; vertical-align: baseline; word-spacing: normal;"><span class="token request-flag" style="border: 0px; color: #d0d0d0; font-family: inherit; font-style: inherit; font-weight: inherit; margin: 0px; outline: 0px; padding: 0px; vertical-align: baseline;">-u</span> sk_test_BQokikJOvBiI2HlWgH4olfQ2</span><span class="token punctuation" style="border: 0px; color: #d0d4d7; font-family: inherit; font-style: inherit; font-weight: inherit; line-height: 1.5em; margin: 0px; outline: 0px; padding: 0px; vertical-align: baseline; word-spacing: normal;">:</span><span style="background-color: transparent;">&nbsp;</span></pre><br />... the Stripe API Key for the general public is&nbsp;<i>sk_test_BQokikJOvBiI2HlWgH4olfQ2</i>.<br /><br />That means that our properties file would look like this:<br /><br /><b>properties/qa-properties.properties</b><br /><pre style="background: #f0f0f0; border: 1px dashed #cccccc; color: black; font-family: &quot;arial&quot;; font-size: 12px; height: auto; line-height: 20px; overflow: auto; padding: 0px; text-align: left; width: 99%;"><code style="color: black; word-wrap: normal;"><i> # Stripe Public API key </i><br /> stripe.api.key=sk_test_BQokikJOvBiI2HlWgH4olfQ2  <br /> stripe.api.version=2015-10-01  </code></pre><br /><h3>How to Read the Properties File</h3>We are going to create a class called <b>LoadProperties </b>to handle fetching the properties data.<br /><br />LoadProperties method (private):<br /><ul><li>Create a static method&nbsp;<i>loadProperties, </i>pointing to where the qa-properties.properties file is located.&nbsp;</li><li>Instantiate a new Properties object, from a class <a href="https://docs.oracle.com/javase/7/docs/api/java/util/Properties.html" target="_blank">built into Java 7</a>.</li><li>Attempt to load the file located at the filepath, catching any errors such as if the file is not there, or there is some &nbsp;Input / Output error opening or closing the file.&nbsp;</li><li>If there are any errors, print a stack trace.&nbsp;</li><li>If there aren't any errors, read the file's contents in a <a href="https://docs.oracle.com/javase/7/docs/api/java/io/FileInputStream.html" target="_blank">FileInputStream</a> called "f", the load the contents into properties.</li><li>Read the entire file, line by line.&nbsp;</li></ul><div>Once this method is created, we can have a public method, <i>qaData</i>, call this private method.&nbsp;</div><br /><b>data/LoadProperties.java</b><br /><pre style="background: #f0f0f0; border: 1px dashed #cccccc; color: black; font-family: &quot;arial&quot;; font-size: 12px; height: auto; line-height: 20px; overflow: auto; padding: 0px; text-align: left; width: 99%;"><code style="color: black; word-wrap: normal;"> public class LoadProperties {  <br />   public static Properties qaData = loadProperties("src/test/java/properties/qa-properties.properties");  <br />   private static Properties loadProperties(String filePath) {  <br />     Properties properties = new Properties();  <br />     try {  <br />       FileInputStream f = new FileInputStream(filePath);  <br />       properties.load(f);  <br />     } catch (FileNotFoundException e) {  <br />       e.printStackTrace();  <br />     } catch (IOException e) {  <br />       e.printStackTrace();  <br />     }  <br />     return properties;  <br />   }  <br />   public static String getPropertyValue(String path, String key) {  <br />     Properties p = loadProperties(path);  <br />     String result = "";  <br />     Set&lt;String&gt; values = p.stringPropertyNames();  <br />     for (String value : values) {  <br />       if (StringUtils.equalsIgnoreCase(value, key)) {  <br />         result = p.getProperty(value);  <br />         break;  <br />       }  <br />     }  <br />     return result;  <br />   }  <br /> }  </code></pre><br /><br /><h3>The Stripe Utilities class</h3>The only acceptable country is "Locale.US". We are going to force everything else to fail.<br /><br /><pre style="background: #f0f0f0; border: 1px dashed #cccccc; color: black; font-family: &quot;arial&quot;; font-size: 12px; height: auto; line-height: 20px; overflow: auto; padding: 0px; text-align: left; width: 99%;"><code style="color: black; word-wrap: normal;"> package libraries;  <br /> import com.stripe.Stripe;  <br /> import data.LoadProperties;  <br /> import org.testng.TestException;  <br /> import org.testng.annotations.Test;  <br /> import java.util.Locale;  <br /> /**  <br />  * Created by tmaher on 2/16/2016.  <br />  */  <br /> public class StripeUtils {  <br />   private static String getAPIKey() {  <br />     return Stripe.apiKey = LoadProperties.qaData.get("stripe.api.key").toString();  <br />   }  <br />   private static String getAPIVersion() {  <br />     return Stripe.apiVersion = LoadProperties.qaData.get("stripe.api.version").toString();  <br />   }  <br />   private static void getAPIKey(Locale country) {  <br />     getAPIVersion();  <br />     if (country.equals(Locale.US)) {  <br />       getAPIKey();  <br />     } else {  <br />       throw new TestException("ERROR: Stripe is used only for US. Country entered: " + country);  <br />     }  <br />   }  <br />   public StripeUtils(Locale country) {  <br />     getAPIKey(country);  <br />   }  <br />   private static StripeUtils setAPIKey(Locale country) {  <br />     return new StripeUtils(country);  <br />   }  <br /> }  </code></pre><br /><h3>Test Early. Test Often.&nbsp;</h3>Let's create a folder called <i>testcases</i>, and place in it a test class, <i>Stripe.java</i>.<br /><br /><b>testcases.Stripe.java:</b><br /><pre style="background: #f0f0f0; border: 1px dashed #cccccc; color: black; font-family: &quot;arial&quot;; font-size: 12px; height: auto; line-height: 20px; overflow: auto; padding: 0px; text-align: left; width: 99%;"><code style="color: black; word-wrap: normal;"> package testcases;  <br /> import libraries.StripeUtils;  <br /> import org.testng.annotations.Test;  <br /> import java.util.Locale;  <br /> /**  <br />  * Created by tmaher on 2/16/2016.  <br />  */  <br /> public class Stripe {  <br />   @Test  <br />   public void test_validCountry() {  <br />     StripeUtils stripe = new StripeUtils(Locale.US);  <br />     // This will always pass.  <br />   }  <br />   @Test  <br />   public void test() {  <br />     StripeUtils stripe = new StripeUtils(Locale.GERMANY);  <br />     // This will always fail: ERROR: Stripe is used only for US. Country entered: de_DE   <br />   }  <br /> }  </code></pre><br />Our test automation structure is starting to be built!<br /><br />With the next blog post, we will be getting into using UriBuilder, HttpGet and other Apache HttpComponents.<br /><br />Until next time, Happy Testing!<br /><br /><b>NEXT: </b><a href="/2016/02/restful-testing-with-stripe-using.html">UriBuilder, HttpGet and other Apache HttpComponents</a><br /><br /><div class="toc-section" id="toc-section"><b>RESTful Testing with Stripe:</b><br /><ul><li><a href="/2016/02/coming-up-how-to-work-with-rest-apis.html">Introduction</a></li><li><b>Part One:</b>&nbsp;<a href="/2016/02/restful-testing-with-stripe-brief.html">Intro to REST APIs</a></li><li><b>Part Two:</b>&nbsp;<a href="/2016/02/restful-testing-with-stripe-interacting.html">Interacting with Stripe using HTTPS and cURL</a></li><li><b>Part Three:</b>&nbsp;<a href="/2016/02/restful-testing-with-stripe-storing-api_23.html">API Keys, Property files, and Initial Setup</a></li><li><b>Part Four:</b>&nbsp;<a href="/2016/02/restful-testing-with-stripe-using.html">UriBuilder, HttpGet and other Apache HttpComponents</a></li><li><b>Part Five:</b>&nbsp;<a href="/2016/02/restful-testing-with-stripe-from-json.html">From JSON to Object: HttpEntity and GSON</a></li><li><b>Source Code:</b>&nbsp;<a href="https://github.com/tjmaher/RESTful_Testing_Using_Stripe">GitHub, T.J. Maher</a></li></ul></div><br /><br /><span style="background-color: white; color: #222222; font-family: &quot;calibri&quot;; font-size: 15.4px; line-height: 21.56px;">-T.J. Maher</span><br /><div><i style="background-color: white; color: #222222; font-family: calibri; font-size: 15.4px; line-height: 21.56px;">&nbsp;Sr. QA Engineer, Fitbit</i><br /><i style="background-color: white; color: #222222; font-family: calibri; font-size: 15.4px; line-height: 21.56px;">&nbsp;Boston, MA</i><br /><i style="background-color: white; color: #222222; font-family: calibri; font-size: 15.4px; line-height: 21.56px;"><br /></i><i style="background-color: white; color: #222222; font-family: calibri; font-size: 15.4px; line-height: 21.56px;">// Automated tester for [ 11 ] month and counting!</i><br /><i style="background-color: white; color: #222222; font-family: calibri; font-size: 15.4px; line-height: 21.56px;"><br /></i><i style="background-color: white; color: #222222; font-family: calibri; font-size: 15.4px; line-height: 21.56px;">Please note: 'Adventures in Automation' is a personal blog about automated testing. It is not an official blog of&nbsp;<a href="http://www.fitbit.com/" style="color: #888888; text-decoration: none;" target="_blank">Fitbit.com</a>.&nbsp;</i></div><div><i style="background-color: white; color: #222222; font-family: calibri; font-size: 15.4px; line-height: 21.56px;"><br /></i></div><br />