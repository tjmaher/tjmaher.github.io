---
layout: post
title: 'Test The-Internet 2.0: Page Factories: Setting up, creating them, and understanding
  how they work'
date: '2016-06-30T23:26:00.002-04:00'
author: T.J. Maher
tags:
- Page Object
- test framework
- Page Factory
modified_time: '2016-07-05T17:06:16.801-04:00'
thumbnail: https://2.bp.blogspot.com/-MedHu5ui8gs/V3WekrjHh3I/AAAAAAAALLU/Kh-IbMJIA4QOORp2pb2fvKyh5_mUIpgOQCLcB/s72-c/login.png
blogger_id: tag:blogger.com,1999:blog-3868566217808655382.post-7415687677777184256
blogger_orig_url: http://www.tjmaher.com/2016/06/page-factories-setting-up-creating-them.html
---

Let's say we wanted to automated a Login Page such as the one on Dave Haeffner's test site, <a href="http://the-internet.herokuapp.com/login" target="_blank">The-Internet</a>. How would we find the username, password and Login button so we can enter the appropriate text into the appropriate text boxes?<br /><b><u><br /></u></b><br /><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="https://2.bp.blogspot.com/-MedHu5ui8gs/V3WekrjHh3I/AAAAAAAALLU/Kh-IbMJIA4QOORp2pb2fvKyh5_mUIpgOQCLcB/s1600/login.png" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" height="283" src="https://2.bp.blogspot.com/-MedHu5ui8gs/V3WekrjHh3I/AAAAAAAALLU/Kh-IbMJIA4QOORp2pb2fvKyh5_mUIpgOQCLcB/s400/login.png" width="400" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;"><i>Dave Haeffner's&nbsp;<a href="http://the-internet.herokuapp.com/login">http://the-internet.herokuapp.com/login</a></i></td></tr></tbody></table>Like we did <a href="http://www.tjmaher.com/2015/06/simple-manipulation-of-login-page.html" target="_blank">last July</a>,&nbsp;we would make sure that Selenium WebDriver methods such as sendKeys (to enter text) and click (to click on a button) <a href="http://www.tjmaher.com/2015/06/creating-common-utilities-for-webdriver.html" target="_blank">were safely wrapped</a> in a set of common utilities, then <a href="http://www.tjmaher.com/2015/07/the-internet-page-object-model-examples.html" target="_blank">call these new methods by selector</a>, such as css or id.<br /><br />... Or we could just use the <b>PageFactory</b>.<br /><br /><div><ul><li>Read more about <a href="http://www.tjmaher.com/2015/06/spotlight-on-dave-haeffner.html" target="_blank">Dave Haeffner</a></li><li>View the <a href="https://github.com/SeleniumHQ/selenium/blob/master/java/client/src/org/openqa/selenium/support/PageFactory.java" target="_blank">PageFactory on GitHub</a></li></ul></div><br />Using it is relatively simple to implement, as shown in the illustration below. Reading the JavaDocs and understanding how it works is much harder.<br /><br /><br /><a name='more'></a><h2>Setting Up Page Factory and Page Object</h2><br />A Page Object is a class that contains all our web elements for that page. We implement the PageFactory by importing PageFactory and FindBy into the page object. We use the @FindBy annotations and search for the web element by id or css selector. Then we store the result returned in a WebElement, such as <i>usernameTextbox</i> or <i>passwordTextbox</i>, ready to use!<br /><br /><br /><ul><li>Need to more about <a href="http://www.tjmaher.com/2015/05/page-objects-and-design-patterns-in.html" target="_blank">Page Objects</a> and locators?</li><li>Or how WebDriver <a href="http://www.tjmaher.com/2015/04/how-selenium-webdriver-uses-css.html" target="_blank">uses CSS Selectors</a>?</li></ul><br /><br />Remember though, we need to make sure to initialize all the web elements. Who knows what is in them when the page is created? This is why we are using the PageFactory method <i>initElements</i> to initialize the elements on the page, passing in an instance of the WebDriver we will be using (<i>driver</i>), and the instance of the LoginPage (<i>this</i>).<br /><br />To instantiate a new Firefox browser, then pass that into a newly created instance of the Login page object:<br /><br /><pre class="brush: java">WebDriver driver = new FirefoxDriver();<br />LoginPage login = new LoginPage(driver);</pre><br />But what could the new Login page object look like? <br /><br /><b><u>LoginPage.java:</u></b><br /><pre class="brush: java">import org.openqa.selenium.WebDriver;<br />import org.openqa.selenium.WebElement;<br />import org.openqa.selenium.support.FindBy;<br />import org.openqa.selenium.support.PageFactory;<br /><br />public class LoginPage {<br /><br />    private String password;<br /><br />    @FindBy(id = "h2")<br />    private WebElement header;<br /><br />    @FindBy(css = "[name='username']")<br />    private WebElement usernameTextbox;<br /><br />    @FindBy(css = "[name='password']")<br />    private WebElement passwordTextbox;<br /><br />    @FindBy(css = "[type='submit'][class='radius']")<br />    private WebElement loginButton;<br /><br />    private WebDriver driver;<br /><br />    public LoginPage(WebDriver driver) {<br />        this.driver = driver;<br />        PageFactory.initElements(driver, this);<br />    }<br /><br />    public void loginAs(String username) {<br />        usernameTextbox.sendKeys(username);<br />        String password = "SuperSecretPassword!";<br />        passwordTextbox.sendKeys(this.password);<br />        loginButton.click();<br />    }<br /></pre><br />The loginAs method:<br /><br /><ul><li>Takes the value of the username and enters the text into the textbox using WebDriver's sendKeys method.&nbsp;</li><li>Declares a String variable, entering in the super secret password.</li><li>Enters the password.</li><li>Selects the login button.&nbsp;</li></ul><h2></h2><h2>Using the Page Factory and Page Object&nbsp;</h2><div><br />Now, let's write a test that uses the page object.&nbsp;</div><br /><b><u><br /></u></b><b><u>LoginPageTest.java:</u></b><br /><pre class="brush: java">    @Test<br />    public void test_FirefoxLogin() throws Exception{<br />        driver = new FirefoxDriver();<br />        driver.get("http://the-internet.herokuapp.com/login");<br />        LoginPage login = new LoginPage(driver);<br />        login.loginAs("tomsmith");<br />        // Place assert statements here.<br />    }<br /></pre><br />The test will:<br /><br /><ul><li>Open up a new Firefox &nbsp;browser and go to the Login page in the URL.&nbsp;</li><li>Instantiate a new Login Page, passing in the Firefox driver.</li><li>All web elements will be located and initialized.</li><li>The username and password will be entered and the Login Button will be selected.</li></ul><div>... If we were doing a real test, we would have done some assertions, searching for the success (or failure) of the login, judging by the page we were on and the message that was displayed on the page, but that is for the next chapter.&nbsp;</div><div><br /></div><h2>What Happens With Web Elements Not Found?</h2>Before, we had to make sure that Selenium method was wrapped in try/ catch blocks in the&nbsp;<a href="http://www.tjmaher.com/2015/12/automate-amazon-commonutils-methods-and.html" target="_blank">CommonUtilities</a>&nbsp;library class we created. What if an element could not be found due to a slow loading page, or a page that could not be found? We might get an oh-so-vague message of a&nbsp;<i>NullPointerError</i>.<br /><br />Let's make a typo, calling the selector for the "username" a "usernam" and see what happens:<br /><pre style="background: #f0f0f0; border: 1px dashed #cccccc; color: black; font-family: &quot;arial&quot;; font-size: 12px; height: auto; line-height: 20px; overflow: auto; padding: 0px; text-align: left; width: 99%;"><code style="color: black; word-wrap: normal;"> org.openqa.selenium.NoSuchElementException: Unable to locate element: {"method":"css selector","selector":"[name='usernam']"}  <br /><i> &lt;snip&gt;  </i><br /> *** Element info: {Using=css selector, value=[name='usernam']}  <br />     <i>&lt;snip&gt; </i> <br />      at pages.LoginPage.loginAs(LoginPage.java:43)  <br />      at pages.LoginPageTest.test_FirefoxLogin(LoginPageTest.java:56)  <br />      <i>&lt;/snip&gt; </i> <br /> Caused by: org.openqa.selenium.NoSuchElementException: Unable to locate element: {"method":"css selector","selector":"[name='usernam']"}  <br /> For documentation on this error, please visit: http://seleniumhq.org/exceptions/no_such_element.html  <br /></code></pre><br />Ugh! A huge stack trace and a wall of text. It's not the <a href="http://www.tjmaher.com/2016/02/do-you-actually-know-what-your.html" target="_blank">logging that I like to see</a>&nbsp;as a former manual tester, but it is something. At least it is better than a <i>NullPointerError</i>.<br /><br /><h2>How Does the Page Factory Initialization Work?&nbsp;</h2>Let's take a look at the <a href="https://github.com/SeleniumHQ/selenium/blob/master/java/client/src/org/openqa/selenium/support/PageFactory.java" target="_blank">Page Factory section</a> of Selenium WebDriver to see how the page is initialized:<br /><br /><blockquote>"Instantiate an instance of the given class, and set a lazy proxy for each of the WebElement and List&lt;WebElement&gt; fields that have been declared, assuming that the field name is also the HTML element's 'id' or 'name'.<br /><br />"This means that for the class: public class Page { private WebElement submit; } there will be an element that can be located using the xpath expression <i>"//*[@id='submit']"</i> or <i>"//*[@name='submit']"</i><br /><br />"By default, the element or the list is looked up each and every time a method is called upon it. To change this behaviour, simply annotate the field with the CacheLookup. To change how the element is located, use the FindBy annotation. This method will attempt to instantiate the class given to it, preferably using a constructor which takes a WebDriver instance as its only argument or falling back on a no-arg constructor. An exception will be thrown if the class cannot be instantiated".</blockquote><br /><br />Did you understand that? It seems that we don't really need the @FindBy annotation if we just name the WebElement variable the same as the element's name or id. <br /><br />When we instantiate a new LoginPage, passing along the WebDriver instance, it then is stored in the <i>WebDriver driver</i> property of the class, and then is passed into initElements, along with an instance of the entire LoginPage that will be proxied: usernameTextbox, passwordTextbox and all web elements.<br /><br /><pre class="brush: java">    public LoginPage(WebDriver driver) {<br />        this.driver = driver;<br />        PageFactory.initElements(driver, this);<br />    }</pre><br />From what I can tell:<br /><br /><ul><li>InitElements takes in the Firefox driver and lists our LoginPage as the page object to proxy.</li><li>PageFactory then passes these values into&nbsp;<span style="background-color: white; color: #333333; font-family: &quot;consolas&quot; , &quot;liberation mono&quot; , &quot;menlo&quot; , &quot;courier&quot; , monospace; font-size: 12px; line-height: 16.8px; white-space: pre;">instantiatePage(driver, pageClassToProxy)</span></li><li>An attempt is made to find the LoginPage class constructor, providing there is a method, no instantiation exception, run time exception, or illegal access. &nbsp;</li><li>It does this by using the <i>java.lang.reflect.Constructor class</i></li><li>See&nbsp;<i>pageClassToProxy.getConstructor(WebDriver.class)</i></li><li>Then, it is returning<i> constructor.newInstance(driver),&nbsp;</i>capturing the information in the page variable back in initElements.&nbsp;</li></ul><br />According to JournalDev's <a href="http://www.journaldev.com/1789/java-reflection-example-tutorial" target="_blank">Java Reflection Example Tutorial</a>, "getConstructors() method returns the list of public constructors of the class reference of object". We are passing in WebDriver.class, getting that classes constructors.<br /><br />Only when you are using the proxy for the page class does the LoginPage get initialized. When you actually are using the proxy, then the proxy finally loads the web elements with the elements on the page. We don't need to wrap the element up with try/ catch blocks like we did with CommonUtils before.<br /><br /><h2>What about&nbsp;@FindBy?</h2>Taking a look at the <a href="https://github.com/SeleniumHQ/selenium/blob/master/java/client/src/org/openqa/selenium/support/FindBy.java" target="_blank">FindBy documentation</a> in WebDriver, you can find a locator by more than just @FindBy(id = "h2") or @FindBy(css = "[name='username']").<br /><br />You can use: id, name, className, css, tagName, linkText, partialLinkText and even xpath, if you want to live dangerously.<br /><blockquote>"Used to mark a field on a Page Object to indicate an alternative mechanism for locating the element or a list of elements. Used in conjunction with PageFactory this allows users to quickly and easily create PageObjects.<br /><br />"You can either use this annotation by specifying both 'how' and 'using' or by specifying one of the location strategies (eg: "id") with an appropriate value to use. Both options will delegate down to the matching By methods in By class".</blockquote><br />Next, we will look at setting up Selenium Grid.<br /><br />Until then, Happy Testing! <br /><br />-T.J. Maher<br />Sr. QA Engineer, <br />Fitbit-Boston<br /><br /><i>// QA Engineer since Aug. 1996 <br />// Automation developer for [ 1.5 ] years and still counting!<br />// Check out Adventures in Automation on <a href="https://www.facebook.com/AdventuresInAutomation/">Facebook</a>! </i>